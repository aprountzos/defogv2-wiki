"use strict";(globalThis.webpackChunkdefogv_2_wiki=globalThis.webpackChunkdefogv_2_wiki||[]).push([[3806],{1470:(e,n,r)=>{r.d(n,{A:()=>T});var i=r(6540),t=r(4164),l=r(7559),s=r(3104),c=r(6347),o=r(205),a=r(7485),d=r(1682),h=r(679);function u(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,i.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:r,default:i}})=>({value:e,label:n,attributes:r,default:i}))}(r);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,r])}function x({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const r=(0,c.W6)(),t=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,a.aZ)(t),(0,i.useCallback)(e=>{if(!t)return;const n=new URLSearchParams(r.location.search);n.set(t,e),r.replace({...r.location,search:n.toString()})},[t,r])]}function k(e){const{defaultValue:n,queryString:r=!1,groupId:t}=e,l=p(e),[s,c]=(0,i.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!x({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=n.find(e=>e.default)??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:l})),[a,d]=m({queryString:r,groupId:t}),[u,k]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,t]=(0,h.Dv)(n);return[r,(0,i.useCallback)(e=>{n&&t.set(e)},[n,t])]}({groupId:t}),v=(()=>{const e=a??u;return x({value:e,tabValues:l})?e:null})();(0,o.A)(()=>{v&&c(v)},[v]);return{selectedValue:s,selectValue:(0,i.useCallback)(e=>{if(!x({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);c(e),d(e),k(e)},[d,k,l]),tabValues:l}}var v=r(2303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(4848);function b({className:e,block:n,selectedValue:r,selectValue:i,tabValues:l}){const c=[],{blockElementScrollPositionUntilNextRender:o}=(0,s.a_)(),a=e=>{const n=e.currentTarget,t=c.indexOf(n),s=l[t].value;s!==r&&(o(n),i(s))},d=e=>{let n=null;switch(e.key){case"Enter":a(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;n=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;n=c[r]??c[c.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":n},e),children:l.map(({value:e,label:n,attributes:i})=>(0,j.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{c.push(e)},onKeyDown:d,onClick:a,...i,className:(0,t.A)("tabs__item",g.tabItem,i?.className,{"tabs__item--active":r===e}),children:n??e},e))})}function f({lazy:e,children:n,selectedValue:r}){const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=l.find(e=>e.props.value===r);return e?(0,i.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:l.map((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function y(e){const n=k(e);return(0,j.jsxs)("div",{className:(0,t.A)(l.G.tabs.container,"tabs-container",g.tabList),children:[(0,j.jsx)(b,{...n,...e}),(0,j.jsx)(f,{...n,...e})]})}function T(e){const n=(0,v.A)();return(0,j.jsx)(y,{...e,children:u(e.children)},String(n))}},1926:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"linking","title":"Linking Clusters","description":"Connect your clusters for secure cross-cluster communication","source":"@site/docs/linking.mdx","sourceDirName":".","slug":"/linking","permalink":"/defogv2-wiki/docs/linking","draft":false,"unlisted":false,"editUrl":"https://github.com/aprountzos/defogv2-wiki/tree/main/docs/docs/linking.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Linking Clusters","description":"Connect your clusters for secure cross-cluster communication","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Installing Linkerd","permalink":"/defogv2-wiki/docs/install"},"next":{"title":"Testing Connectivity","permalink":"/defogv2-wiki/docs/test-connectivity"}}');var t=r(4848),l=r(8453),s=r(1470),c=r(9365);const o={title:"Linking Clusters",description:"Connect your clusters for secure cross-cluster communication",sidebar_position:6},a="Linking Clusters",d={},h=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Understanding Links",id:"understanding-links",level:2},{value:"What is a Link?",id:"what-is-a-link",level:3},{value:"Link Direction",id:"link-direction",level:3},{value:"Step 1: Link Bot to Mid",id:"step-1-link-bot-to-mid",level:2},{value:"Step 1.1: Get Mid Cluster Information",id:"step-11-get-mid-cluster-information",level:3},{value:"Step 1.2: Generate Link Manifest",id:"step-12-generate-link-manifest",level:3},{value:"Step 1.3: Inspect the Link",id:"step-13-inspect-the-link",level:3},{value:"Step 1.4: Apply the Link",id:"step-14-apply-the-link",level:3},{value:"Step 1.5: Verify the Link",id:"step-15-verify-the-link",level:3},{value:"Step 1.6: Check Service Mirror Controller",id:"step-16-check-service-mirror-controller",level:3},{value:"Step 1.7: View Logs (Optional)",id:"step-17-view-logs-optional",level:3},{value:"Step 2: Link Mid to Top",id:"step-2-link-mid-to-top",level:2},{value:"Step 2.1: Get Top Cluster Information",id:"step-21-get-top-cluster-information",level:3},{value:"Step 2.2: Generate Link Manifest",id:"step-22-generate-link-manifest",level:3},{value:"Step 2.3: Apply the Link",id:"step-23-apply-the-link",level:3},{value:"Step 2.4: Verify the Link",id:"step-24-verify-the-link",level:3},{value:"Step 2.5: Verify Controller",id:"step-25-verify-controller",level:3},{value:"Step 3: Verify All Links",id:"step-3-verify-all-links",level:2},{value:"Check Link Status",id:"check-link-status",level:3},{value:"View All Links",id:"view-all-links",level:3},{value:"Understanding Service Mirroring",id:"understanding-service-mirroring",level:2},{value:"How Services Get Mirrored",id:"how-services-get-mirrored",level:3},{value:"Naming Convention",id:"naming-convention",level:3},{value:"Example Service Flow",id:"example-service-flow",level:3},{value:"Testing the Links",id:"testing-the-links",level:2},{value:"Create a Test Service in Top",id:"create-a-test-service-in-top",level:3},{value:"Wait for Service to Be Ready",id:"wait-for-service-to-be-ready",level:3},{value:"Check for Mirrored Service in Mid",id:"check-for-mirrored-service-in-mid",level:3},{value:"Verify Gateway Status",id:"verify-gateway-status",level:3},{value:"Check for Mirrored Service in Bot",id:"check-for-mirrored-service-in-bot",level:3},{value:"Testing Connectivity",id:"testing-connectivity",level:2},{value:"Deploy Test Pod in Bot",id:"deploy-test-pod-in-bot",level:3},{value:"Wait for Pod",id:"wait-for-pod",level:3},{value:"Test Connection",id:"test-connection",level:3},{value:"View Traffic in Linkerd Viz",id:"view-traffic-in-linkerd-viz",level:3},{value:"Advanced: Creating a Service in Mid",id:"advanced-creating-a-service-in-mid",level:2},{value:"Deploy Service in Mid",id:"deploy-service-in-mid",level:3},{value:"Check Mirroring in Bot",id:"check-mirroring-in-bot",level:3},{value:"Test Both Services",id:"test-both-services",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Link Shows as Not Alive",id:"link-shows-as-not-alive",level:3},{value:"Services Not Being Mirrored",id:"services-not-being-mirrored",level:3},{value:"Can&#39;t Connect to Mirrored Service",id:"cant-connect-to-mirrored-service",level:3},{value:"Understanding the Complete Architecture",id:"understanding-the-complete-architecture",level:2},{value:"Current Setup",id:"current-setup",level:3},{value:"Service Discovery",id:"service-discovery",level:3},{value:"Managing Links",id:"managing-links",level:2},{value:"Viewing Link Details",id:"viewing-link-details",level:3},{value:"Updating a Link",id:"updating-a-link",level:3},{value:"Deleting a Link",id:"deleting-a-link",level:3},{value:"Quick Reference",id:"quick-reference",level:2},{value:"Link Creation Command",id:"link-creation-command",level:3},{value:"Verification Commands",id:"verification-commands",level:3},{value:"What&#39;s Next?",id:"whats-next",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"linking-clusters",children:"Linking Clusters"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Now that Linkerd is installed on all clusters, we'll connect them together to enable secure cross-cluster communication."}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TB\r\n    Bot[Bot Cluster - Edge] --\x3e|Link| Mid[Mid Cluster - Fog]\r\n    Mid --\x3e|Link| Top[Top Cluster - Cloud]\r\n    \r\n    Note1[Bot can discover<br/>services in Mid]\r\n    Note2[Mid can discover<br/>services in Top]\r\n    \r\n    Bot -.-> Note1\r\n    Mid -.-> Note2"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What we'll create:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Link from Bot to Mid"})," - Bot can access Mid services"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Link from Mid to Top"})," - Mid can access Top services"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This creates a hierarchical architecture mimicking real cloud-fog-edge topology."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 All three clusters running"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Linkerd installed on all clusters"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 MetalLB configured with gateway IPs assigned"}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 All ",(0,t.jsx)(n.code,{children:"linkerd check"})," and ",(0,t.jsx)(n.code,{children:"linkerd multicluster check"})," passing"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"understanding-links",children:"Understanding Links"}),"\n",(0,t.jsx)(n.h3,{id:"what-is-a-link",children:"What is a Link?"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"Link"})," is a Linkerd resource that:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Establishes a secure connection to another cluster"}),"\n",(0,t.jsx)(n.li,{children:"Enables service mirroring from that cluster"}),"\n",(0,t.jsx)(n.li,{children:"Creates a gateway tunnel for cross-cluster traffic"}),"\n"]}),"\n",(0,t.jsx)(n.mermaid,{value:"graph LR\r\n    subgraph Source[Source Cluster - Bot]\r\n        Link[Link Resource<br/>points to Mid]\r\n        Mirror[Service Mirror<br/>Controller]\r\n        App[Application]\r\n    end\r\n    \r\n    subgraph Target[Target Cluster - Mid]\r\n        Gateway[Gateway<br/>LoadBalancer]\r\n        Service[Actual Service]\r\n    end\r\n    \r\n    Link --\x3e Mirror\r\n    Mirror -.->|Watches| Gateway\r\n    Mirror --\x3e|Creates mirrors| App\r\n    App --\x3e|Calls mirror| Gateway\r\n    Gateway --\x3e Service"}),"\n",(0,t.jsx)(n.h3,{id:"link-direction",children:"Link Direction"}),"\n",(0,t.jsxs)(n.p,{children:["Links are ",(0,t.jsx)(n.strong,{children:"directional"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Source cluster"})," \u2192 creates Link \u2192 ",(0,t.jsx)(n.strong,{children:"Target cluster"})]}),"\n",(0,t.jsx)(n.li,{children:"Source can discover services from Target"}),"\n",(0,t.jsx)(n.li,{children:"Target doesn't automatically discover services from Source"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Our setup:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Bot (source) \u2192 Link \u2192 Mid (target)\r\nMid (source) \u2192 Link \u2192 Top (target)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Bot can call services in Mid and Top (via Mid)"}),"\n",(0,t.jsx)(n.li,{children:"Mid can call services in Top"}),"\n",(0,t.jsx)(n.li,{children:"Top cannot call services in Mid or Bot (unless we create reverse links)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"step-1-link-bot-to-mid",children:"Step 1: Link Bot to Mid"}),"\n",(0,t.jsx)(n.p,{children:"We'll connect the Bot cluster to the Mid cluster."}),"\n",(0,t.jsx)(n.h3,{id:"step-11-get-mid-cluster-information",children:"Step 1.1: Get Mid Cluster Information"}),"\n",(0,t.jsx)(n.p,{children:"First, gather information about the Mid cluster:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Get Mid gateway IP\r\nMID_GATEWAY_IP=$(kubectl get svc -n linkerd-multicluster linkerd-gateway \\\r\n  --context k3d-mid \\\r\n  -o jsonpath=\'{.status.loadBalancer.ingress[0].ip}\')\r\n\r\necho "Mid Gateway IP: $MID_GATEWAY_IP"\r\n\r\n# Get Mid API server address\r\nMID_SERVER_IP=$(docker inspect k3d-mid-serverlb \\\r\n  --format \'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\')\r\n\r\nMID_API="https://${MID_SERVER_IP}:6443"\r\n\r\necho "Mid API Server: $MID_API"\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Save these values!"})," You'll need them in the next steps."]}),"\n",(0,t.jsx)(n.p,{children:"Example output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Mid Gateway IP: 172.18.0.210\r\nMid API Server: https://172.18.0.4:6443\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-12-generate-link-manifest",children:"Step 1.2: Generate Link Manifest"}),"\n",(0,t.jsx)(n.p,{children:"Generate the Link resource that Bot will use to connect to Mid:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"linkerd multicluster link \\\r\n  --context k3d-mid \\\r\n  --cluster-name mid \\\r\n  --api-server-address $MID_API \\\r\n  --gateway-addresses ${MID_GATEWAY_IP}:4143 \\\r\n  --selector to-export=true > link-bot-to-mid.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What each flag does:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Flag"}),(0,t.jsx)(n.th,{children:"Purpose"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--cluster-name"})}),(0,t.jsx)(n.td,{children:"Name for the target cluster"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"mid"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--api-server-address"})}),(0,t.jsx)(n.td,{children:"API server of target cluster"}),(0,t.jsx)(n.td,{children:"Mid's API address"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--gateway-addresses"})}),(0,t.jsx)(n.td,{children:"Gateway IP and port"}),(0,t.jsx)(n.td,{children:"Mid's gateway IP:4143"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"--selector"})}),(0,t.jsx)(n.td,{children:"Label selector for exported services"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"to-export=true"})})]})]})]}),"\n",(0,t.jsx)(n.admonition,{title:"Service Selector",type:"tip",children:(0,t.jsxs)(n.p,{children:["Only services with the label ",(0,t.jsx)(n.code,{children:"to-export=true"})," in Mid will be mirrored to Bot. This gives you control over what's shared."]})}),"\n",(0,t.jsx)(n.h3,{id:"step-13-inspect-the-link",children:"Step 1.3: Inspect the Link"}),"\n",(0,t.jsx)(n.p,{children:"Let's see what was generated:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cat link-bot-to-mid.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"You'll see:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Link"})," resource - Connection configuration"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Secret"})," - Credentials to access Mid cluster"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ServiceAccount"})," - For the service mirror controller"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"step-14-apply-the-link",children:"Step 1.4: Apply the Link"}),"\n",(0,t.jsx)(n.p,{children:"Apply the Link in the Bot cluster:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply --context k3d-bot -f link-bot-to-mid.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"secret/cluster-credentials-mid created\r\nlink.multicluster.linkerd.io/mid created\r\nclusterrole.rbac.authorization.k8s.io/linkerd-service-mirror-access-local-resources-mid created\r\nclusterrolebinding.rbac.authorization.k8s.io/linkerd-service-mirror-access-local-resources-mid created\r\nrole.rbac.authorization.k8s.io/linkerd-service-mirror-read-remote-creds-mid created\r\nrolebinding.rbac.authorization.k8s.io/linkerd-service-mirror-read-remote-creds-mid created\r\nserviceaccount/linkerd-service-mirror-mid created\r\ndeployment.apps/linkerd-service-mirror-mid created\r\nservice/probe-gateway-mid created\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-15-verify-the-link",children:"Step 1.5: Verify the Link"}),"\n",(0,t.jsx)(n.p,{children:"Check the Link status:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# View Link resource\r\nkubectl get link --context k3d-bot -n linkerd-multicluster\r\n\r\n# Check if gateway is alive\r\nlinkerd multicluster gateways --context k3d-bot\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CLUSTER   ALIVE    NUM_SVC   LATENCY\r\nmid       True     0         1ms\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"ALIVE should be True!"})]}),"\n",(0,t.jsx)(n.h3,{id:"step-16-check-service-mirror-controller",children:"Step 1.6: Check Service Mirror Controller"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n linkerd-multicluster --context k3d-bot\n"})}),"\n",(0,t.jsx)(n.p,{children:"You should see a new pod:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"NAME                                      READY   STATUS    RESTARTS   AGE\r\nlinkerd-gateway-xxx                       2/2     Running   0          10m\r\nlinkerd-service-mirror-mid-xxx            2/2     Running   0          1m\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-17-view-logs-optional",children:"Step 1.7: View Logs (Optional)"}),"\n",(0,t.jsx)(n.p,{children:"See what the service mirror is doing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs -n linkerd-multicluster \\\r\n  -l app=linkerd-service-mirror \\\r\n  -c controller \\\r\n  --context k3d-bot \\\r\n  --tail 20\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-2-link-mid-to-top",children:"Step 2: Link Mid to Top"}),"\n",(0,t.jsx)(n.p,{children:"Now connect the Mid cluster to the Top cluster."}),"\n",(0,t.jsx)(n.h3,{id:"step-21-get-top-cluster-information",children:"Step 2.1: Get Top Cluster Information"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Get Top gateway IP\r\nTOP_GATEWAY_IP=$(kubectl get svc -n linkerd-multicluster linkerd-gateway \\\r\n  --context k3d-top \\\r\n  -o jsonpath=\'{.status.loadBalancer.ingress[0].ip}\')\r\n\r\necho "Top Gateway IP: $TOP_GATEWAY_IP"\r\n\r\n# Get Top API server address\r\nTOP_SERVER_IP=$(docker inspect k3d-top-serverlb \\\r\n  --format \'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\')\r\n\r\nTOP_API="https://${TOP_SERVER_IP}:6443"\r\n\r\necho "Top API Server: $TOP_API"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"step-22-generate-link-manifest",children:"Step 2.2: Generate Link Manifest"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"linkerd multicluster link \\\r\n  --context k3d-top \\\r\n  --cluster-name top \\\r\n  --api-server-address $TOP_API \\\r\n  --gateway-addresses ${TOP_GATEWAY_IP}:4143 \\\r\n  --selector to-export=true > link-mid-to-top.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-23-apply-the-link",children:"Step 2.3: Apply the Link"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply --context k3d-mid -f link-mid-to-top.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-24-verify-the-link",children:"Step 2.4: Verify the Link"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check Link\r\nkubectl get link --context k3d-mid -n linkerd-multicluster\r\n\r\n# Check gateway status\r\nlinkerd multicluster gateways --context k3d-mid\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CLUSTER   ALIVE    NUM_SVC   LATENCY\r\ntop       True     0         1ms\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-25-verify-controller",children:"Step 2.5: Verify Controller"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n linkerd-multicluster --context k3d-mid\n"})}),"\n",(0,t.jsx)(n.p,{children:"Should show:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"linkerd-gateway-xxx                       2/2     Running   0          10m\r\nlinkerd-service-mirror-top-xxx            2/2     Running   0          1m\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-3-verify-all-links",children:"Step 3: Verify All Links"}),"\n",(0,t.jsx)(n.h3,{id:"check-link-status",children:"Check Link Status"}),"\n",(0,t.jsxs)(s.A,{children:[(0,t.jsxs)(c.A,{value:"bot",label:"Bot Cluster",default:!0,children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"linkerd multicluster check --context k3d-bot\r\nlinkerd multicluster gateways --context k3d-bot\n"})}),(0,t.jsxs)(n.p,{children:["Should show link to ",(0,t.jsx)(n.code,{children:"mid"})," as ",(0,t.jsx)(n.strong,{children:"ALIVE"}),"."]})]}),(0,t.jsxs)(c.A,{value:"mid",label:"Mid Cluster",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"linkerd multicluster check --context k3d-mid\r\nlinkerd multicluster gateways --context k3d-mid\n"})}),(0,t.jsxs)(n.p,{children:["Should show link to ",(0,t.jsx)(n.code,{children:"top"})," as ",(0,t.jsx)(n.strong,{children:"ALIVE"}),"."]})]}),(0,t.jsxs)(c.A,{value:"top",label:"Top Cluster",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"linkerd multicluster check --context k3d-top\r\nlinkerd multicluster gateways --context k3d-top\n"})}),(0,t.jsx)(n.p,{children:"Should show no links (Top is the apex)."})]})]}),"\n",(0,t.jsx)(n.h3,{id:"view-all-links",children:"View All Links"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'echo "=== Bot Cluster Links ==="\r\nkubectl get links -A --context k3d-bot\r\n\r\necho ""\r\necho "=== Mid Cluster Links ==="\r\nkubectl get links -A --context k3d-mid\r\n\r\necho ""\r\necho "=== Top Cluster Links ==="\r\nkubectl get links -A --context k3d-top\n'})}),"\n",(0,t.jsx)(n.p,{children:"Expected:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"=== Bot Cluster Links ===\r\nNAMESPACE              NAME   CLUSTER-NAME   ALIVE\r\nlinkerd-multicluster   mid    mid            True\r\n\r\n=== Mid Cluster Links ===\r\nNAMESPACE              NAME   CLUSTER-NAME   ALIVE\r\nlinkerd-multicluster   top    top            True\r\n\r\n=== Top Cluster Links ===\r\nNo resources found\n"})}),"\n",(0,t.jsx)(n.h2,{id:"understanding-service-mirroring",children:"Understanding Service Mirroring"}),"\n",(0,t.jsx)(n.h3,{id:"how-services-get-mirrored",children:"How Services Get Mirrored"}),"\n",(0,t.jsxs)(n.p,{children:["When you label a service with ",(0,t.jsx)(n.code,{children:"to-export=true"})," in Mid:"]}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant Mid as Mid Cluster\r\n    participant Mirror as Service Mirror<br/>(in Bot)\r\n    participant Bot as Bot Cluster\r\n    \r\n    Mid->>Mid: Service labeled<br/>to-export=true\r\n    Mirror->>Mid: Watch for exported services\r\n    Mid->>Mirror: Service detected\r\n    Mirror->>Bot: Create mirror service\r\n    Bot->>Bot: Service available as<br/>servicename-mid"}),"\n",(0,t.jsx)(n.h3,{id:"naming-convention",children:"Naming Convention"}),"\n",(0,t.jsx)(n.p,{children:"Mirrored services get a suffix:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Original (Target)"}),(0,t.jsx)(n.th,{children:"Mirrored (Source)"}),(0,t.jsx)(n.th,{children:"Notes"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"hello"})," in Mid"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"hello-mid"})," in Bot"]}),(0,t.jsx)(n.td,{children:"Original name + cluster name"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"api"})," in Top"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"api-top"})," in Mid"]}),(0,t.jsx)(n.td,{children:"Original name + cluster name"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"hello"})," in Top"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"hello-top"})," in Bot"]}),(0,t.jsx)(n.td,{children:"Via Mid (not direct)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"example-service-flow",children:"Example Service Flow"}),"\n",(0,t.jsx)(n.p,{children:"Let's trace a request from Bot to Top:"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TB\r\n    subgraph Bot[Bot Cluster]\r\n        AppB[Application]\r\n        MirrorT[hello-top<br/>mirror]\r\n        MirrorM[hello-mid<br/>mirror]\r\n        GWB[Gateway]\r\n    end\r\n    \r\n    subgraph Mid[Mid Cluster]\r\n        GWM_In[Gateway In]\r\n        MirrorT2[hello-top<br/>mirror]\r\n        GWM_Out[Gateway Out]\r\n    end\r\n    \r\n    subgraph Top[Top Cluster]\r\n        GWT[Gateway In]\r\n        ServiceT[hello<br/>actual service]\r\n    end\r\n    \r\n    AppB --\x3e|1. Call hello-top| MirrorT\r\n    MirrorT --\x3e|2. Route via| GWB\r\n    GWB --\x3e|3. mTLS tunnel| GWM_In\r\n    GWM_In --\x3e|4. Route to| MirrorT2\r\n    MirrorT2 --\x3e|5. Route via| GWM_Out\r\n    GWM_Out --\x3e|6. mTLS tunnel| GWT\r\n    GWT --\x3e|7. Forward to| ServiceT"}),"\n",(0,t.jsx)(n.admonition,{title:"Multi-Hop Communication",type:"note",children:(0,t.jsx)(n.p,{children:"Bot can reach Top services, but the traffic flows through Mid. There's no direct Bot\u2192Top link."})}),"\n",(0,t.jsx)(n.h2,{id:"testing-the-links",children:"Testing the Links"}),"\n",(0,t.jsx)(n.h3,{id:"create-a-test-service-in-top",children:"Create a Test Service in Top"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Create namespace\r\nkubectl create namespace test --context k3d-top\r\n\r\n# Annotate for Linkerd injection\r\nkubectl annotate namespace test linkerd.io/inject=enabled --context k3d-top\r\n\r\n# Deploy hello service\r\nkubectl apply --context k3d-top -n test -f - <<EOF\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: hello\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: hello\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: hello\r\n    spec:\r\n      containers:\r\n      - name: hello\r\n        image: hashicorp/http-echo\r\n        args:\r\n        - "-text=Hello from Top cluster!"\r\n        - "-listen=:8080"\r\n        ports:\r\n        - containerPort: 8080\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: hello\r\n  labels:\r\n    to-export: "true"\r\nspec:\r\n  selector:\r\n    app: hello\r\n  ports:\r\n  - name: http\r\n    port: 8080\r\n    targetPort: 8080\r\nEOF\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Export Label",type:"tip",children:(0,t.jsxs)(n.p,{children:["Notice the ",(0,t.jsx)(n.code,{children:'to-export: "true"'})," label on the Service. This is required for mirroring!"]})}),"\n",(0,t.jsx)(n.h3,{id:"wait-for-service-to-be-ready",children:"Wait for Service to Be Ready"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl wait --for=condition=ready pod \\\r\n  -l app=hello \\\r\n  -n test \\\r\n  --context k3d-top \\\r\n  --timeout=60s\n"})}),"\n",(0,t.jsx)(n.h3,{id:"check-for-mirrored-service-in-mid",children:"Check for Mirrored Service in Mid"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Should see hello-top service appear\r\nkubectl get services -n test --context k3d-mid --watch\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Wait for ",(0,t.jsx)(n.code,{children:"hello-top"})," to appear (may take 30 seconds):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"NAME        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\r\nhello-top   ClusterIP   10.43.xxx.xxx   <none>        8080/TCP   10s\n"})}),"\n",(0,t.jsx)(n.p,{children:"Press Ctrl+C when you see it."}),"\n",(0,t.jsx)(n.h3,{id:"verify-gateway-status",children:"Verify Gateway Status"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"linkerd multicluster gateways --context k3d-mid\n"})}),"\n",(0,t.jsx)(n.p,{children:"Should now show:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CLUSTER   ALIVE    NUM_SVC   LATENCY\r\ntop       True     1         1ms\n"})}),"\n",(0,t.jsx)(n.p,{children:"NUM_SVC changed from 0 to 1! \u2705"}),"\n",(0,t.jsx)(n.h3,{id:"check-for-mirrored-service-in-bot",children:"Check for Mirrored Service in Bot"}),"\n",(0,t.jsx)(n.p,{children:"The service should also appear in Bot (via Mid):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get services -n test --context k3d-bot --watch\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Wait for ",(0,t.jsx)(n.code,{children:"hello-top"})," to appear."]}),"\n",(0,t.jsx)(n.h2,{id:"testing-connectivity",children:"Testing Connectivity"}),"\n",(0,t.jsx)(n.h3,{id:"deploy-test-pod-in-bot",children:"Deploy Test Pod in Bot"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Create namespace\r\nkubectl create namespace test --context k3d-bot\r\n\r\n# Annotate for injection\r\nkubectl annotate namespace test linkerd.io/inject=enabled --context k3d-bot\r\n\r\n# Deploy curl pod\r\nkubectl apply --context k3d-bot -n test -f - <<EOF\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: curl\r\nspec:\r\n  containers:\r\n  - name: curl\r\n    image: curlimages/curl\r\n    command: ["sleep", "infinity"]\r\nEOF\n'})}),"\n",(0,t.jsx)(n.h3,{id:"wait-for-pod",children:"Wait for Pod"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl wait --for=condition=ready pod/curl \\\r\n  -n test \\\r\n  --context k3d-bot \\\r\n  --timeout=60s\n"})}),"\n",(0,t.jsx)(n.h3,{id:"test-connection",children:"Test Connection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Test calling hello-top from Bot\r\nkubectl exec -it curl -n test --context k3d-bot -- \\\r\n  curl -s http://hello-top:8080\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Hello from Top cluster!\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\ud83c\udf89 ",(0,t.jsx)(n.strong,{children:"Success!"})," Bot is calling a service in Top through the secure gateway tunnel!"]}),"\n",(0,t.jsx)(n.h3,{id:"view-traffic-in-linkerd-viz",children:"View Traffic in Linkerd Viz"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Open dashboard\r\nlinkerd viz dashboard --context k3d-bot\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Navigate to the ",(0,t.jsx)(n.code,{children:"test"})," namespace and watch the traffic flow."]}),"\n",(0,t.jsx)(n.h2,{id:"advanced-creating-a-service-in-mid",children:"Advanced: Creating a Service in Mid"}),"\n",(0,t.jsx)(n.p,{children:"Let's create a service in Mid and test the full chain."}),"\n",(0,t.jsx)(n.h3,{id:"deploy-service-in-mid",children:"Deploy Service in Mid"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Create namespace if needed\r\nkubectl create namespace test --context k3d-mid --dry-run=client -o yaml | \\\r\n  kubectl apply --context k3d-mid -f -\r\n\r\n# Annotate\r\nkubectl annotate namespace test linkerd.io/inject=enabled --context k3d-mid --overwrite\r\n\r\n# Deploy service\r\nkubectl apply --context k3d-mid -n test -f - <<EOF\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: hello\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: hello\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: hello\r\n    spec:\r\n      containers:\r\n      - name: hello\r\n        image: hashicorp/http-echo\r\n        args:\r\n        - "-text=Hello from Mid cluster!"\r\n        - "-listen=:8080"\r\n        ports:\r\n        - containerPort: 8080\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: hello\r\n  labels:\r\n    to-export: "true"\r\nspec:\r\n  selector:\r\n    app: hello\r\n  ports:\r\n  - name: http\r\n    port: 8080\r\n    targetPort: 8080\r\nEOF\n'})}),"\n",(0,t.jsx)(n.h3,{id:"check-mirroring-in-bot",children:"Check Mirroring in Bot"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get services -n test --context k3d-bot\n"})}),"\n",(0,t.jsx)(n.p,{children:"Should now see:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"NAME        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\r\nhello-mid   ClusterIP   10.43.xxx.xxx   <none>        8080/TCP   10s\r\nhello-top   ClusterIP   10.43.xxx.xxx   <none>        8080/TCP   5m\n"})}),"\n",(0,t.jsx)(n.h3,{id:"test-both-services",children:"Test Both Services"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Call Mid service\r\nkubectl exec -it curl -n test --context k3d-bot -- \\\r\n  curl -s http://hello-mid:8080\r\n\r\n# Call Top service\r\nkubectl exec -it curl -n test --context k3d-bot -- \\\r\n  curl -s http://hello-top:8080\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Hello from Mid cluster!\r\nHello from Top cluster!\n"})}),"\n",(0,t.jsx)(n.p,{children:"Perfect! Bot can now reach services in both Mid and Top! \ud83c\udf89"}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"link-shows-as-not-alive",children:"Link Shows as Not Alive"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check gateway is accessible:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# From source cluster, test gateway connectivity\r\nkubectl exec -n linkerd-multicluster \\\r\n  -it $(kubectl get pod -n linkerd-multicluster -l app=linkerd-gateway --context k3d-bot -o jsonpath='{.items[0].metadata.name}') \\\r\n  --context k3d-bot \\\r\n  -c nginx -- curl -vk https://MID_GATEWAY_IP:4143\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check gateway pod:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n linkerd-multicluster --context k3d-mid\r\nkubectl logs -n linkerd-multicluster -l app=linkerd-gateway --context k3d-mid\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Verify MetalLB:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get svc -n linkerd-multicluster linkerd-gateway --context k3d-mid\n"})}),"\n",(0,t.jsx)(n.p,{children:"Gateway should have EXTERNAL-IP assigned."}),"\n",(0,t.jsx)(n.h3,{id:"services-not-being-mirrored",children:"Services Not Being Mirrored"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check service has export label:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get svc hello -n test --context k3d-top -o yaml | grep to-export\n"})}),"\n",(0,t.jsx)(n.p,{children:"Should show:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'labels:\r\n  to-export: "true"\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check service mirror logs:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs -n linkerd-multicluster \\\r\n  -l app=linkerd-service-mirror \\\r\n  -c controller \\\r\n  --context k3d-bot \\\r\n  --tail 50\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Verify Link selector:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get link -n linkerd-multicluster --context k3d-bot -o yaml\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Check ",(0,t.jsx)(n.code,{children:"selector"})," matches your service labels."]}),"\n",(0,t.jsx)(n.h3,{id:"cant-connect-to-mirrored-service",children:"Can't Connect to Mirrored Service"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check service exists:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get svc -n test --context k3d-bot\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check endpoints:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get endpoints -n test --context k3d-bot\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Test DNS resolution:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it curl -n test --context k3d-bot -- \\\r\n  nslookup hello-mid.test.svc.cluster.local\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check Linkerd proxy:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it curl -n test --context k3d-bot -c linkerd-proxy -- \\\r\n  wget -qO- http://localhost:4191/metrics | grep hello-mid\n"})}),"\n",(0,t.jsx)(n.h2,{id:"understanding-the-complete-architecture",children:"Understanding the Complete Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"current-setup",children:"Current Setup"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TB\r\n    subgraph Bot[Bot Cluster]\r\n        BotApp[Applications]\r\n        BotMirrorM[hello-mid<br/>mirror]\r\n        BotMirrorT[hello-top<br/>mirror]\r\n        BotGW[Gateway]\r\n    end\r\n    \r\n    subgraph Mid[Mid Cluster]\r\n        MidGWIn[Gateway In]\r\n        MidService[hello<br/>service]\r\n        MidMirrorT[hello-top<br/>mirror]\r\n        MidGWOut[Gateway Out]\r\n    end\r\n    \r\n    subgraph Top[Top Cluster]\r\n        TopGW[Gateway In]\r\n        TopService[hello<br/>service]\r\n    end\r\n    \r\n    BotApp --\x3e|Local| BotMirrorM\r\n    BotApp --\x3e|Local| BotMirrorT\r\n    \r\n    BotMirrorM --\x3e|via| BotGW\r\n    BotGW -.->|mTLS| MidGWIn\r\n    MidGWIn --\x3e MidService\r\n    \r\n    BotMirrorT --\x3e|via| BotGW\r\n    BotGW -.->|mTLS| MidGWIn\r\n    MidGWIn --\x3e MidMirrorT\r\n    MidMirrorT --\x3e|via| MidGWOut\r\n    MidGWOut -.->|mTLS| TopGW\r\n    TopGW --\x3e TopService"}),"\n",(0,t.jsx)(n.h3,{id:"service-discovery",children:"Service Discovery"}),"\n",(0,t.jsx)(n.p,{children:"From Bot's perspective:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# List all services\r\nkubectl get svc -A --context k3d-bot\r\n\r\n# Services Bot can call:\r\n# - Local services (in Bot)\r\n# - hello-mid (in Mid, via gateway)\r\n# - hello-top (in Top, via Mid's gateway)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"managing-links",children:"Managing Links"}),"\n",(0,t.jsx)(n.h3,{id:"viewing-link-details",children:"Viewing Link Details"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Get Link details\r\nkubectl get link mid -n linkerd-multicluster --context k3d-bot -o yaml\r\n\r\n# Check service mirror deployment\r\nkubectl get deployment -n linkerd-multicluster --context k3d-bot\r\n\r\n# View gateway status\r\nlinkerd multicluster gateways --context k3d-bot\n"})}),"\n",(0,t.jsx)(n.h3,{id:"updating-a-link",children:"Updating a Link"}),"\n",(0,t.jsx)(n.p,{children:"If gateway IP changes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Delete old link\r\nkubectl delete link mid -n linkerd-multicluster --context k3d-bot\r\n\r\n# Regenerate and apply\r\nlinkerd multicluster link \\\r\n  --context k3d-mid \\\r\n  --cluster-name mid \\\r\n  --api-server-address $NEW_MID_API \\\r\n  --gateway-addresses ${NEW_MID_GATEWAY_IP}:4143 \\\r\n  --selector to-export=true | \\\r\n  kubectl apply --context k3d-bot -f -\n"})}),"\n",(0,t.jsx)(n.h3,{id:"deleting-a-link",children:"Deleting a Link"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Delete link resource\r\nkubectl delete link mid -n linkerd-multicluster --context k3d-bot\r\n\r\n# This will:\r\n# - Stop service mirroring\r\n# - Remove mirrored services\r\n# - Delete service mirror controller\n"})}),"\n",(0,t.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,t.jsx)(n.h3,{id:"link-creation-command",children:"Link Creation Command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# General format\r\nlinkerd multicluster link \\\r\n  --context <TARGET_CONTEXT> \\\r\n  --cluster-name <NAME_FOR_TARGET> \\\r\n  --api-server-address <TARGET_API> \\\r\n  --gateway-addresses <TARGET_GATEWAY_IP>:4143 \\\r\n  --selector <LABEL_SELECTOR> | \\\r\n  kubectl apply --context <SOURCE_CONTEXT> -f -\n"})}),"\n",(0,t.jsx)(n.h3,{id:"verification-commands",children:"Verification Commands"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Check links\r\nkubectl get links -A --context <CLUSTER>\r\n\r\n# Check gateways\r\nlinkerd multicluster gateways --context <CLUSTER>\r\n\r\n# Check mirrored services\r\nkubectl get svc -A --context <CLUSTER> | grep -E "NAME|-(top|mid|bot)"\r\n\r\n# Test connectivity\r\nkubectl exec -it <POD> -n <NAMESPACE> --context <CLUSTER> -- \\\r\n  curl http://<SERVICE>-<CLUSTER>:<PORT>\n'})}),"\n",(0,t.jsx)(n.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,t.jsx)(n.p,{children:"Your clusters are now linked! Next:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/local-setup/testing-connectivity",children:"Testing Connectivity"})})," - Deploy applications and test the full setup"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Resources:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://linkerd.io/2.14/features/multicluster/",children:"Linkerd Multicluster"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://linkerd.io/2.14/tasks/multicluster/",children:"Service Mirroring"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://linkerd.io/2.14/reference/multicluster/",children:"Gateway Configuration"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>c});var i=r(6540);const t={},l=i.createContext(t);function s(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(l.Provider,{value:n},e.children)}},9365:(e,n,r)=>{r.d(n,{A:()=>s});r(6540);var i=r(4164);const t={tabItem:"tabItem_Ymn6"};var l=r(4848);function s({children:e,hidden:n,className:r}){return(0,l.jsx)("div",{role:"tabpanel",className:(0,i.A)(t.tabItem,r),hidden:n,children:e})}}}]);