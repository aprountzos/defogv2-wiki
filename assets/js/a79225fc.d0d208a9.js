"use strict";(globalThis.webpackChunkdefogv_2_wiki=globalThis.webpackChunkdefogv_2_wiki||[]).push([[1724],{7345:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"architecture/data-flow","title":"Complete Data Flows","description":"End-to-end examples showing how both strategies work in real scenarios.","source":"@site/docs/architecture/data-flow.mdx","sourceDirName":"architecture","slug":"/architecture/data-flow","permalink":"/defogv2-wiki/docs/architecture/data-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/aprountzos/defogv2-wiki/tree/main/docs/docs/architecture/data-flow.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Complete Data Flows","description":"End-to-end examples showing how both strategies work in real scenarios.","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/defogv2-wiki/docs/"},"next":{"title":"Architecture Overview","permalink":"/defogv2-wiki/docs/architecture/overview"}}');var i=n(4848),s=n(8453);const a={title:"Complete Data Flows",description:"End-to-end examples showing how both strategies work in real scenarios.",sidebar_position:2},l="Complete Data Flows",c={},d=[{value:"Flow 1: Stress-Based Traffic Shift",id:"flow-1-stress-based-traffic-shift",level:2},{value:"Sequence Diagram",id:"sequence-diagram",level:3},{value:"Timeline",id:"timeline",level:3},{value:"Configuration Impact",id:"configuration-impact",level:3},{value:"Flow 2: High RPS on Mirrored Service",id:"flow-2-high-rps-on-mirrored-service",level:2},{value:"Sequence Diagram",id:"sequence-diagram-1",level:3},{value:"State Changes",id:"state-changes",level:3},{value:"Flow 3: No Local Space - LFU Eviction",id:"flow-3-no-local-space---lfu-eviction",level:2},{value:"Sequence Diagram",id:"sequence-diagram-2",level:3},{value:"RPS Analysis",id:"rps-analysis",level:3},{value:"Flow 4: Both Strategies Active Simultaneously",id:"flow-4-both-strategies-active-simultaneously",level:2},{value:"Sequence Diagram",id:"sequence-diagram-3",level:3},{value:"Strategy Coordination",id:"strategy-coordination",level:3},{value:"Flow 5: Peer Cluster Communication",id:"flow-5-peer-cluster-communication",level:2},{value:"Sequence Diagram",id:"sequence-diagram-4",level:3},{value:"Multi-Peer Query",id:"multi-peer-query",level:3},{value:"Flow 6: Low RPS Service Marked for Deletion",id:"flow-6-low-rps-service-marked-for-deletion",level:2},{value:"Sequence Diagram",id:"sequence-diagram-5",level:3},{value:"State Machine",id:"state-machine",level:3},{value:"Flow 7: Complete Multi-Cluster Scenario",id:"flow-7-complete-multi-cluster-scenario",level:2},{value:"System State Diagram",id:"system-state-diagram",level:3},{value:"Timeline of Events",id:"timeline-of-events",level:3},{value:"Decision Tree",id:"decision-tree",level:3},{value:"Performance Characteristics",id:"performance-characteristics",level:2},{value:"Response Times",id:"response-times",level:3},{value:"Resource Usage",id:"resource-usage",level:3},{value:"Scalability",id:"scalability",level:3}];function o(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"complete-data-flows",children:"Complete Data Flows"})}),"\n",(0,i.jsx)(r.p,{children:"End-to-end examples showing how both strategies work in real scenarios."}),"\n",(0,i.jsx)(r.h2,{id:"flow-1-stress-based-traffic-shift",children:"Flow 1: Stress-Based Traffic Shift"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Scenario"}),": Local pods become overloaded, need immediate relief."]}),"\n",(0,i.jsx)(r.h3,{id:"sequence-diagram",children:"Sequence Diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    participant P as Pods (api)\r\n    participant M as Monitor\r\n    participant O as Orchestrator\r\n    participant S as Scheduler\r\n    participant E as Executor\r\n    participant TS as TrafficSplit\r\n    \r\n    rect rgb(255, 240, 240)\r\n        Note over P,TS: Phase 1: Stress Detected\r\n        P->>P: Load increases\r\n        P->>P: CPU: 85%\r\n        M->>P: Query metrics\r\n        P--\x3e>M: CPU: 85%, Mem: 70%\r\n        M->>M: Calculate stress: 0.85\r\n        M->>M: Check threshold: 0.85 > 0.80\r\n        M->>O: StressEvent<br/>{service: "api", stress: 0.85}\r\n    end\r\n    \r\n    rect rgb(240, 255, 240)\r\n        Note over O,E: Phase 2: Decision & Execution\r\n        O->>O: Current split: 100/0\r\n        O->>S: Calculate split<br/>{stress: 0.85}\r\n        S->>S: Apply algorithm<br/>0.80 < 0.85 < 0.90\r\n        S--\x3e>O: Decision: 30% to mirror\r\n        \r\n        O->>E: UpdateTrafficSplit<br/>{local: 70%, mirror: 30%}\r\n        E->>E: Validate request\r\n        E->>TS: Apply TrafficSplit CRD\r\n        TS--\x3e>E: Updated\r\n        E--\x3e>O: Success\r\n    end\r\n    \r\n    rect rgb(240, 240, 255)\r\n        Note over P,TS: Phase 3: Traffic Diverted\r\n        Note over P: Load reduced\r\n        P->>P: CPU: 60%\r\n        Note over TS: 30% traffic to mirror\r\n    end\r\n    \r\n    rect rgb(255, 255, 240)\r\n        Note over M,E: Phase 4: Recovery\r\n        M->>P: Query metrics\r\n        P--\x3e>M: CPU: 60%\r\n        M->>M: Stress: 0.60 < 0.70\r\n        M->>O: StressEvent<br/>{service: "api", stress: 0.60}\r\n        \r\n        O->>S: Calculate split\r\n        S--\x3e>O: Decision: 0% to mirror\r\n        O->>E: UpdateTrafficSplit<br/>{local: 100%, mirror: 0%}\r\n        E->>TS: Apply\r\n        Note over P,TS: All traffic back to local\r\n    end'}),"\n",(0,i.jsx)(r.h3,{id:"timeline",children:"Timeline"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Time"}),(0,i.jsx)(r.th,{children:"Event"}),(0,i.jsx)(r.th,{children:"Action"}),(0,i.jsx)(r.th,{children:"Result"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+0s"}),(0,i.jsx)(r.td,{children:"CPU reaches 85%"}),(0,i.jsx)(r.td,{children:"Monitor detects stress"}),(0,i.jsx)(r.td,{children:"StressEvent emitted"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+2s"}),(0,i.jsx)(r.td,{children:"Orchestrator receives event"}),(0,i.jsx)(r.td,{children:"Calculate split: 30%"}),(0,i.jsx)(r.td,{children:"Decision made"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+5s"}),(0,i.jsx)(r.td,{children:"Executor updates CRD"}),(0,i.jsx)(r.td,{children:"Apply TrafficSplit"}),(0,i.jsx)(r.td,{children:"30% traffic to mirror"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+10s"}),(0,i.jsx)(r.td,{children:"Load reduces to 60%"}),(0,i.jsx)(r.td,{children:"Monitor detects recovery"}),(0,i.jsx)(r.td,{children:"StressEvent emitted"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+12s"}),(0,i.jsx)(r.td,{children:"Orchestrator receives event"}),(0,i.jsx)(r.td,{children:"Calculate split: 0%"}),(0,i.jsx)(r.td,{children:"Decision made"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+15s"}),(0,i.jsx)(r.td,{children:"Executor updates CRD"}),(0,i.jsx)(r.td,{children:"Apply TrafficSplit"}),(0,i.jsx)(r.td,{children:"100% traffic to local"})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"configuration-impact",children:"Configuration Impact"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"stressThresholds:\r\n  medium: 0.70   # At 85%, this triggers high threshold\r\n  high: 0.80     # \u2190 Triggered here\r\n  critical: 0.90\r\n\r\ntrafficSplitIncrement: 10  # Could adjust by 10% increments\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"flow-2-high-rps-on-mirrored-service",children:"Flow 2: High RPS on Mirrored Service"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Scenario"}),": A mirrored service becomes popular and should be deployed locally."]}),"\n",(0,i.jsx)(r.h3,{id:"sequence-diagram-1",children:"Sequence Diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    participant M as Monitor\r\n    participant O as Orchestrator\r\n    participant S as Scheduler\r\n    participant E as Executor\r\n    participant K8S as Kubernetes\r\n    \r\n    rect rgb(240, 255, 240)\r\n        Note over M,K8S: Phase 1: High RPS Detected\r\n        M->>M: Track RPS for "payments-mirrored"\r\n        M->>M: RPS: 500 > threshold: 300\r\n        M->>O: HighRPSEvent<br/>{service: "payments-mirrored",<br/>RPS: 500, isLocal: false}\r\n    end\r\n    \r\n    rect rgb(255, 240, 240)\r\n        Note over O,S: Phase 2: Check Capacity\r\n        O->>O: Check if already local\r\n        O->>O: Not deployed locally\r\n        O->>M: GET /metrics/capacity\r\n        M--\x3e>O: CapacityReport<br/>{freeCPU: 2.5, freeMem: 4.0}\r\n        O->>O: Has enough capacity\r\n    end\r\n    \r\n    rect rgb(240, 240, 255)\r\n        Note over O,K8S: Phase 3: Deploy Locally\r\n        O->>E: Deploy<br/>{service: "payments",<br/>replicas: 2}\r\n        E->>E: Validate request\r\n        E->>K8S: Create Deployment\r\n        K8S--\x3e>E: Deployment created\r\n        E->>K8S: Create Service\r\n        K8S--\x3e>E: Service created\r\n        E--\x3e>O: DeployResponse<br/>{success: true}\r\n    end\r\n    \r\n    rect rgb(255, 255, 240)\r\n        Note over O,E: Phase 4: Update Traffic\r\n        O->>E: UpdateTrafficSplit<br/>{local: 100%, mirror: 0%}\r\n        E->>E: Apply TrafficSplit CRD\r\n        E--\x3e>O: Success\r\n        Note over M,E: All traffic now goes to local\r\n    end'}),"\n",(0,i.jsx)(r.h3,{id:"state-changes",children:"State Changes"}),"\n",(0,i.jsx)(r.mermaid,{value:"stateDiagram-v2\r\n    [*] --\x3e Mirrored: Service exists on peer\r\n    Mirrored --\x3e Detecting: RPS increases\r\n    Detecting --\x3e HighRPS: RPS > 300\r\n    HighRPS --\x3e CheckingCapacity: Orchestrator checks\r\n    CheckingCapacity --\x3e Deploying: Has capacity\r\n    Deploying --\x3e Local: Deployment created\r\n    Local --\x3e TrafficUpdated: TrafficSplit applied\r\n    TrafficUpdated --\x3e [*]: 100% local traffic\r\n    \r\n    CheckingCapacity --\x3e LFU: No capacity\r\n    LFU --\x3e Deploying: Evicted service\r\n    LFU --\x3e PeerQuery: Cannot evict\r\n    PeerQuery --\x3e Mirrored: Peers cannot help"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"flow-3-no-local-space---lfu-eviction",children:"Flow 3: No Local Space - LFU Eviction"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Scenario"}),": High RPS on mirrored service, but no local capacity. Need to evict a low-RPS service."]}),"\n",(0,i.jsx)(r.h3,{id:"sequence-diagram-2",children:"Sequence Diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    participant M as Monitor\r\n    participant O as Orchestrator\r\n    participant S as Scheduler (LFU)\r\n    participant E as Executor\r\n    \r\n    rect rgb(255, 240, 240)\r\n        Note over M,E: Phase 1: High RPS + No Capacity\r\n        M->>O: HighRPSEvent<br/>{service: "new-api", RPS: 450}\r\n        O->>M: GET /metrics/capacity\r\n        M--\x3e>O: CapacityReport<br/>{freeCPU: 0.1, freeMem: 0.2}\r\n        O->>O: Not enough capacity\r\n    end\r\n    \r\n    rect rgb(240, 255, 240)\r\n        Note over O,S: Phase 2: Run LFU\r\n        O->>M: GET /metrics/snapshot\r\n        M--\x3e>O: All services with RPS\r\n        \r\n        Note over O: Current services:<br/>api: 450 RPS<br/>payments: 320 RPS<br/>old-api: 45 RPS<br/>reports: 150 RPS\r\n        \r\n        O->>S: DecideEviction<br/>{services, minRPSToKeep: 50}\r\n        S->>S: Sort by RPS ascending\r\n        S->>S: Lowest: "old-api" (45 RPS)\r\n        S->>S: Check: 45 < 50?\r\n        S--\x3e>O: EvictionDecision<br/>{canEvict: true,<br/>toDelete: ["old-api"]}\r\n    end\r\n    \r\n    rect rgb(240, 240, 255)\r\n        Note over O,E: Phase 3: Evict & Deploy\r\n        O->>E: Delete deployment<br/>{service: "old-api"}\r\n        E->>E: Delete from Kubernetes\r\n        E--\x3e>O: Deleted\r\n        \r\n        O->>E: UpdateTrafficSplit<br/>{old-api: local 0%, mirror 100%}\r\n        E--\x3e>O: Updated\r\n        \r\n        Note over O: Space freed\r\n        \r\n        O->>E: Deploy<br/>{service: "new-api"}\r\n        E--\x3e>O: Deployed\r\n        \r\n        O->>E: UpdateTrafficSplit<br/>{new-api: local 100%, mirror 0%}\r\n        E--\x3e>O: Updated\r\n    end'}),"\n",(0,i.jsx)(r.h3,{id:"rps-analysis",children:"RPS Analysis"}),"\n",(0,i.jsx)(r.mermaid,{value:"graph TD\r\n    A[All Local Services] --\x3e B{Sort by RPS}\r\n    \r\n    B --\x3e C1[old-api: 45 RPS]\r\n    B --\x3e C2[reports: 150 RPS]\r\n    B --\x3e C3[payments: 320 RPS]\r\n    B --\x3e C4[api: 450 RPS]\r\n    \r\n    C1 --\x3e D{45 < MinRPSToKeep 50?}\r\n    D --\x3e|Yes| E[Evict old-api]\r\n    D --\x3e|No| F[Cannot evict]\r\n    \r\n    style E fill:#e1ffe1\r\n    style F fill:#ffcccc"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"flow-4-both-strategies-active-simultaneously",children:"Flow 4: Both Strategies Active Simultaneously"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Scenario"}),": Local pods are stressed AND mirrored service has high RPS."]}),"\n",(0,i.jsx)(r.h3,{id:"sequence-diagram-3",children:"Sequence Diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    participant P as Pods (api)\r\n    participant M as Monitor\r\n    participant O as Orchestrator\r\n    participant S as Scheduler\r\n    participant E as Executor\r\n    \r\n    Note over P,E: Initial: api deployed locally, api-mirrored exists\r\n    \r\n    par Stress Strategy (Fast)\r\n        P->>P: CPU spikes to 85%\r\n        M->>M: Detect stress\r\n        M->>O: StressEvent<br/>{service: "api", stress: 0.85}\r\n        O->>S: Calculate split\r\n        S--\x3e>O: 30% to mirror\r\n        O->>E: UpdateTrafficSplit<br/>{local: 70%, mirror: 30%}\r\n        E--\x3e>O: Traffic shifted\r\n        Note over P,E: Immediate relief\r\n    and RPS Strategy (Slow)\r\n        M->>M: Track RPS\r\n        M->>M: api-mirrored: 400 RPS\r\n        M->>O: HighRPSEvent<br/>{service: "api-mirrored", RPS: 400}\r\n        O->>O: Already deployed locally\r\n        O->>O: Consider scaling\r\n        O->>M: Check capacity\r\n        alt Has capacity\r\n            O->>E: Scale api: 3\u21925 replicas\r\n            Note over E: Long-term solution\r\n        else No capacity\r\n            O->>O: Keep current state\r\n            Note over O: Stress strategy<br/>handles load\r\n        end\r\n    end\r\n    \r\n    rect rgb(240, 255, 240)\r\n        Note over P,E: Result: Traffic shifted + more replicas\r\n        Note over P: CPU reduces to 60%\r\n        M->>O: StressEvent (recovery)\r\n        O->>E: Shift traffic back<br/>{local: 100%, mirror: 0%}\r\n    end'}),"\n",(0,i.jsx)(r.h3,{id:"strategy-coordination",children:"Strategy Coordination"}),"\n",(0,i.jsx)(r.mermaid,{value:"graph TB\r\n    A[Event: High Stress + High RPS] --\x3e B{Stress Strategy}\r\n    A --\x3e C{RPS Strategy}\r\n    \r\n    B --\x3e D[Shift Traffic<br/>Immediate<br/>2-5 seconds]\r\n    C --\x3e E{Already Local?}\r\n    E --\x3e|Yes| F[Scale Replicas<br/>Long-term<br/>30-60 seconds]\r\n    E --\x3e|No| G[Deploy Locally<br/>Long-term<br/>30-60 seconds]\r\n    \r\n    D --\x3e H[Result: Load Balanced]\r\n    F --\x3e H\r\n    G --\x3e H\r\n    \r\n    style D fill:#ffe1e1\r\n    style F fill:#e1ffe1\r\n    style G fill:#e1ffe1"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"flow-5-peer-cluster-communication",children:"Flow 5: Peer Cluster Communication"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Scenario"}),": Cannot deploy locally, ask peer cluster for help."]}),"\n",(0,i.jsx)(r.h3,{id:"sequence-diagram-4",children:"Sequence Diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    participant O1 as Orchestrator<br/>(Cluster A)\r\n    participant M1 as Monitor<br/>(Cluster A)\r\n    participant E1 as Executor<br/>(Cluster A)\r\n    participant E2 as Executor<br/>(Cluster B)\r\n    participant O2 as Orchestrator<br/>(Cluster B)\r\n    participant S2 as Scheduler<br/>(Cluster B)\r\n    \r\n    rect rgb(255, 240, 240)\r\n        Note over O1,E1: Phase 1: Local Cannot Deploy\r\n        M1->>O1: HighRPSEvent<br/>{service: "payments", RPS: 500}\r\n        O1->>M1: Check capacity\r\n        M1--\x3e>O1: No capacity\r\n        O1->>O1: Try LFU\r\n        O1->>O1: All services RPS > minRPSToKeep\r\n        Note over O1: Cannot make space locally\r\n    end\r\n    \r\n    rect rgb(240, 255, 240)\r\n        Note over O1,E2: Phase 2: Query Peer\r\n        O1->>E2: POST /peer/v1/can-deploy<br/>{service, resources, RPS: 500}\r\n        E2->>O2: Can we deploy this?\r\n    end\r\n    \r\n    rect rgb(240, 240, 255)\r\n        Note over O2,S2: Phase 3: Peer Decision\r\n        O2->>O2: Check if already deployed\r\n        \r\n        alt Already Have It\r\n            O2--\x3e>E2: already_have_it\r\n            E2--\x3e>O1: {"status": "already_have_it"}\r\n        else Has Capacity\r\n            O2->>E2: Deploy now\r\n            E2->>E2: Create deployment\r\n            E2--\x3e>O1: {"status": "will_deploy"}\r\n        else No Capacity - Try LFU\r\n            O2->>S2: Can make space?\r\n            S2->>S2: Find lowest RPS\r\n            \r\n            alt Can Evict\r\n                S2--\x3e>O2: Delete "service-x"\r\n                O2->>E2: Delete & deploy\r\n                E2--\x3e>O1: {"status": "will_deploy"}\r\n            else Cannot Evict\r\n                S2--\x3e>O2: All above threshold\r\n                O2--\x3e>E2: cannot_deploy\r\n                E2--\x3e>O1: {"status": "cannot_deploy",<br/>"reason": "no_capacity"}\r\n            end\r\n        end\r\n    end\r\n    \r\n    rect rgb(255, 255, 240)\r\n        Note over O1,E1: Phase 4: Update Routing\r\n        alt Deployed on Peer\r\n            O1->>E1: UpdateTrafficSplit<br/>{route to Cluster B}\r\n            Note over O1,E1: Traffic goes to Cluster B\r\n        else Not Deployed\r\n            Note over O1: Keep as mirrored<br/>Use stress strategy\r\n        end\r\n    end'}),"\n",(0,i.jsx)(r.h3,{id:"multi-peer-query",children:"Multi-Peer Query"}),"\n",(0,i.jsx)(r.mermaid,{value:"graph TB\r\n    A[Need to Deploy] --\x3e B{Local Capacity?}\r\n    B --\x3e|No| C[Query All Peers]\r\n    \r\n    C --\x3e D[Peer B: can_deploy]\r\n    C --\x3e E[Peer C: already_have_it]\r\n    C --\x3e F[Peer D: no_capacity]\r\n    \r\n    D --\x3e G[Deploy on Peer B]\r\n    E --\x3e H[Route to Peer C]\r\n    F --\x3e I[Skip Peer D]\r\n    \r\n    G --\x3e J[Update Traffic]\r\n    H --\x3e J\r\n    I --\x3e K{Any Success?}\r\n    K --\x3e|No| L[Keep Mirrored]\r\n    \r\n    style G fill:#e1ffe1\r\n    style H fill:#e1ffe1\r\n    style L fill:#ffffe1"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"flow-6-low-rps-service-marked-for-deletion",children:"Flow 6: Low RPS Service Marked for Deletion"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Scenario"}),": Local service has low RPS, marked as candidate but not deleted until needed."]}),"\n",(0,i.jsx)(r.h3,{id:"sequence-diagram-5",children:"Sequence Diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    participant M as Monitor\r\n    participant O as Orchestrator\r\n    \r\n    rect rgb(255, 255, 240)\r\n        Note over M,O: Phase 1: Low RPS Detected\r\n        M->>M: Track "old-api" RPS\r\n        M->>M: old-api: 8 RPS < threshold: 10\r\n        M->>O: LowRPSEvent<br/>{service: "old-api", RPS: 8}\r\n        O->>O: Mark as deletion candidate\r\n        O->>O: Do NOT delete yet\r\n        Note over O: Wait until space needed\r\n    end\r\n    \r\n    Note over M,O: Time passes...\r\n    \r\n    rect rgb(240, 255, 240)\r\n        Note over M,O: Phase 2: Space Needed\r\n        M->>O: HighRPSEvent<br/>{service: "new-api", RPS: 400}\r\n        O->>O: Check capacity: insufficient\r\n        O->>O: Check deletion candidates\r\n        O->>O: Found: "old-api" (RPS: 8)\r\n        O->>O: Delete "old-api"\r\n        O->>O: Deploy "new-api"\r\n    end'}),"\n",(0,i.jsx)(r.h3,{id:"state-machine",children:"State Machine"}),"\n",(0,i.jsx)(r.mermaid,{value:"stateDiagram-v2\r\n    [*] --\x3e Active: Service deployed\r\n    Active --\x3e LowRPS: RPS < 10\r\n    LowRPS --\x3e Candidate: Mark for deletion\r\n    Candidate --\x3e Candidate: Wait (no action)\r\n    Candidate --\x3e Active: RPS increases\r\n    Candidate --\x3e Deleted: Space needed\r\n    Deleted --\x3e [*]\r\n    \r\n    note right of Candidate\r\n        Not deleted immediately\r\n        Only when space needed\r\n    end note"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"flow-7-complete-multi-cluster-scenario",children:"Flow 7: Complete Multi-Cluster Scenario"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Scenario"}),": Full system in action across 3 clusters."]}),"\n",(0,i.jsx)(r.h3,{id:"system-state-diagram",children:"System State Diagram"}),"\n",(0,i.jsx)(r.mermaid,{value:'graph TB\r\n    subgraph "Cluster A (US-West)"\r\n        A1[api: 450 RPS<br/>Stressed: 85%]\r\n        A2[payments: 320 RPS]\r\n        A3[old-api: 8 RPS<br/>Candidate]\r\n    end\r\n    \r\n    subgraph "Cluster B (US-East)"\r\n        B1[api-mirrored: exists]\r\n        B2[reports: 200 RPS]\r\n        B3[user-service: 150 RPS]\r\n    end\r\n    \r\n    subgraph "Cluster C (EU-West)"\r\n        C1[api-mirrored: exists]\r\n        C2[analytics: 180 RPS]\r\n        C3[Free capacity: 3 cores]\r\n    end\r\n    \r\n    A1 -.->|30% traffic| B1\r\n    A1 -.->|70% traffic| A1\r\n    A1 -.->|mirror exists| C1\r\n    \r\n    A3 -.->|will be evicted| A3\r\n    \r\n    style A1 fill:#ffe1e1\r\n    style A3 fill:#ffffe1\r\n    style C3 fill:#e1ffe1'}),"\n",(0,i.jsx)(r.h3,{id:"timeline-of-events",children:"Timeline of Events"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Time"}),(0,i.jsx)(r.th,{children:"Cluster"}),(0,i.jsx)(r.th,{children:"Event"}),(0,i.jsx)(r.th,{children:"Action"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+0s"}),(0,i.jsx)(r.td,{children:"A"}),(0,i.jsx)(r.td,{children:"api pods stressed (85%)"}),(0,i.jsx)(r.td,{children:"Shift 30% traffic to B"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+10s"}),(0,i.jsx)(r.td,{children:"A"}),(0,i.jsx)(r.td,{children:"api-mirrored has 400 RPS"}),(0,i.jsx)(r.td,{children:"Consider deploying locally"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+15s"}),(0,i.jsx)(r.td,{children:"A"}),(0,i.jsx)(r.td,{children:"Check capacity"}),(0,i.jsx)(r.td,{children:"Insufficient space"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+20s"}),(0,i.jsx)(r.td,{children:"A"}),(0,i.jsx)(r.td,{children:"Run LFU"}),(0,i.jsx)(r.td,{children:"Find old-api (8 RPS)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+25s"}),(0,i.jsx)(r.td,{children:"A"}),(0,i.jsx)(r.td,{children:"Delete old-api"}),(0,i.jsx)(r.td,{children:"Space freed"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+30s"}),(0,i.jsx)(r.td,{children:"A"}),(0,i.jsx)(r.td,{children:"Deploy api locally"}),(0,i.jsx)(r.td,{children:"100% local traffic"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T+35s"}),(0,i.jsx)(r.td,{children:"C"}),(0,i.jsx)(r.td,{children:"Receives api-mirrored traffic"}),(0,i.jsx)(r.td,{children:"Acts as backup"})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"decision-tree",children:"Decision Tree"}),"\n",(0,i.jsx)(r.mermaid,{value:"graph TD\r\n    A[Monitor Detects Events] --\x3e B{Stress Event?}\r\n    B --\x3e|Yes| C[Shift Traffic]\r\n    B --\x3e|No| D{High RPS Event?}\r\n    \r\n    D --\x3e|Yes| E{Local Capacity?}\r\n    E --\x3e|Yes| F[Deploy Locally]\r\n    E --\x3e|No| G{Can Evict?}\r\n    \r\n    G --\x3e|Yes| H[Run LFU]\r\n    G --\x3e|No| I[Query Peers]\r\n    \r\n    H --\x3e F\r\n    I --\x3e J{Peer Can Deploy?}\r\n    J --\x3e|Yes| K[Route to Peer]\r\n    J --\x3e|No| L[Keep Mirrored]\r\n    \r\n    style C fill:#ffe1e1\r\n    style F fill:#e1ffe1\r\n    style K fill:#e1f5ff\r\n    style L fill:#ffffe1"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,i.jsx)(r.h3,{id:"response-times",children:"Response Times"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Strategy"}),(0,i.jsx)(r.th,{children:"Detection"}),(0,i.jsx)(r.th,{children:"Decision"}),(0,i.jsx)(r.th,{children:"Execution"}),(0,i.jsx)(r.th,{children:"Total"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Stress-based"}),(0,i.jsx)(r.td,{children:"2-5s"}),(0,i.jsx)(r.td,{children:"<1s"}),(0,i.jsx)(r.td,{children:"2-5s"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"5-10s"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"RPS-based (local)"}),(0,i.jsx)(r.td,{children:"30s"}),(0,i.jsx)(r.td,{children:"1-2s"}),(0,i.jsx)(r.td,{children:"30-60s"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"60-90s"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"RPS-based (peer)"}),(0,i.jsx)(r.td,{children:"30s"}),(0,i.jsx)(r.td,{children:"2-5s"}),(0,i.jsx)(r.td,{children:"60-120s"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"90-150s"})})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"resource-usage",children:"Resource Usage"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Service"}),(0,i.jsx)(r.th,{children:"CPU"}),(0,i.jsx)(r.th,{children:"Memory"}),(0,i.jsx)(r.th,{children:"Description"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Discovery Controller"}),(0,i.jsx)(r.td,{children:"100m"}),(0,i.jsx)(r.td,{children:"128Mi"}),(0,i.jsx)(r.td,{children:"Lightweight reconciliation"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Metrics Monitor"}),(0,i.jsx)(r.td,{children:"200m"}),(0,i.jsx)(r.td,{children:"256Mi"}),(0,i.jsx)(r.td,{children:"Continuous metrics collection"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Scheduler"}),(0,i.jsx)(r.td,{children:"100m"}),(0,i.jsx)(r.td,{children:"128Mi"}),(0,i.jsx)(r.td,{children:"Stateless decision logic"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"200m"}),(0,i.jsx)(r.td,{children:"256Mi"}),(0,i.jsx)(r.td,{children:"State management + coordination"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Executor"}),(0,i.jsx)(r.td,{children:"200m"}),(0,i.jsx)(r.td,{children:"256Mi"}),(0,i.jsx)(r.td,{children:"Kubernetes operations"})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"scalability",children:"Scalability"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Clusters"}),": Tested with 2-10 peer clusters"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Services"}),": Handles 100+ services per cluster"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"RPS"}),": Tracks up to 10,000 RPS per service"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Events"}),": Processes 100+ events/minute"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>l});var t=n(6540);const i={},s=t.createContext(i);function a(e){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);