"use strict";(globalThis.webpackChunkdefogv_2_wiki=globalThis.webpackChunkdefogv_2_wiki||[]).push([[9329],{6401:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"architecture/api-reference","title":"API Reference","description":"Complete API specification for all services and peer communication","source":"@site/docs/architecture/api-reference.mdx","sourceDirName":"architecture","slug":"/architecture/api-reference","permalink":"/defogv2-wiki/docs/architecture/api-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/aprountzos/defogv2-wiki/tree/main/docs/docs/architecture/api-reference.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"API Reference","description":"Complete API specification for all services and peer communication","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Architecture Overview","permalink":"/defogv2-wiki/docs/architecture/overview"},"next":{"title":"Discovery Controller","permalink":"/defogv2-wiki/docs/architecture/components/discovery-controller"}}');var i=r(4848),c=r(8453);const l={title:"API Reference",description:"Complete API specification for all services and peer communication",sidebar_position:4},d="API Reference",t={},a=[{value:"Peer API (Executor)",id:"peer-api-executor",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Endpoints",id:"endpoints",level:3},{value:"GET /peer/v1/capacity",id:"get-peerv1capacity",level:4},{value:"POST /peer/v1/can-deploy",id:"post-peerv1can-deploy",level:4},{value:"POST /peer/v1/deploy",id:"post-peerv1deploy",level:4},{value:"DELETE /peer/v1/services/{name}",id:"delete-peerv1servicesname",level:4},{value:"GET /peer/v1/metrics/{service}",id:"get-peerv1metricsservice",level:4},{value:"GET /peer/v1/health",id:"get-peerv1health",level:4},{value:"Internal APIs",id:"internal-apis",level:2},{value:"Monitor API",id:"monitor-api",level:3},{value:"GET /metrics/stress",id:"get-metricsstress",level:4},{value:"GET /metrics/rps",id:"get-metricsrps",level:4},{value:"GET /metrics/capacity",id:"get-metricscapacity",level:4},{value:"GET /metrics/snapshot",id:"get-metricssnapshot",level:4},{value:"Scheduler API",id:"scheduler-api",level:3},{value:"POST /placement/decide",id:"post-placementdecide",level:4},{value:"POST /eviction/decide",id:"post-evictiondecide",level:4},{value:"POST /clusters/score",id:"post-clustersscore",level:4},{value:"Executor API (Local)",id:"executor-api-local",level:3},{value:"POST /api/v1/deployments",id:"post-apiv1deployments",level:4},{value:"DELETE /api/v1/deployments/{name}",id:"delete-apiv1deploymentsname",level:4},{value:"PATCH /api/v1/deployments/{name}/scale",id:"patch-apiv1deploymentsnamescale",level:4},{value:"POST /api/v1/traffic-splits",id:"post-apiv1traffic-splits",level:4},{value:"Event Types",id:"event-types",level:2},{value:"StressEvent",id:"stressevent",level:3},{value:"HighRPSEvent",id:"highrpsevent",level:3},{value:"LowRPSEvent",id:"lowrpsevent",level:3},{value:"Error Responses",id:"error-responses",level:2},{value:"Common Error Codes",id:"common-error-codes",level:3},{value:"Rate Limiting",id:"rate-limiting",level:2},{value:"Versioning",id:"versioning",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"api-reference",children:"API Reference"})}),"\n",(0,i.jsx)(n.p,{children:"Complete API documentation for internal services and peer-to-peer communication."}),"\n",(0,i.jsx)(n.h2,{id:"peer-api-executor",children:"Peer API (Executor)"}),"\n",(0,i.jsx)(n.p,{children:"The Executor service exposes these endpoints for remote cluster communication."}),"\n",(0,i.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.p,{children:"All peer API requests require Bearer token authentication:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"Authorization: Bearer <cluster-token>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"endpoints",children:"Endpoints"}),"\n",(0,i.jsx)(n.h4,{id:"get-peerv1capacity",children:"GET /peer/v1/capacity"}),"\n",(0,i.jsx)(n.p,{children:"Get current cluster capacity."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "clusterId": "cluster-a",\r\n  "freeCpu": 4.5,\r\n  "freeMemory": 8.2,\r\n  "totalCpu": 8.0,\r\n  "totalMemory": 16.0,\r\n  "schedulablePods": 50,\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response Codes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"})," - Success"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"401 Unauthorized"})," - Invalid or missing token"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"503 Service Unavailable"})," - Cannot calculate capacity"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-peerv1can-deploy",children:"POST /peer/v1/can-deploy"}),"\n",(0,i.jsx)(n.p,{children:"Check if cluster can deploy a service."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "payments",\r\n  "namespace": "default",\r\n  "resources": {\r\n    "cpuRequest": "500m",\r\n    "memoryRequest": "512Mi",\r\n    "cpuLimit": "1000m",\r\n    "memoryLimit": "1Gi"\r\n  },\r\n  "sourceCluster": "cluster-b",\r\n  "currentRps": 450.0\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "will_deploy",\r\n  "message": "Deployment will be initiated",\r\n  "reason": "has_capacity"\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Status Values"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"already_have_it"})," - Service already deployed locally"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"will_deploy"})," - Will deploy the service"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cannot_deploy"})," - Cannot deploy (see reason)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response Codes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"})," - Decision made"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"})," - Invalid request"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"401 Unauthorized"})," - Invalid token"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-peerv1deploy",children:"POST /peer/v1/deploy"}),"\n",(0,i.jsx)(n.p,{children:"Deploy a service on this cluster."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "payments",\r\n  "namespace": "default",\r\n  "image": "myapp:v1.0.0",\r\n  "replicas": 2,\r\n  "resources": {\r\n    "cpuRequest": "500m",\r\n    "memoryRequest": "512Mi",\r\n    "cpuLimit": "1000m",\r\n    "memoryLimit": "1Gi"\r\n  },\r\n  "labels": {\r\n    "app": "payments",\r\n    "version": "v1"\r\n  },\r\n  "sourceCluster": "cluster-b"\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "serviceName": "payments",\r\n  "endpoint": "payments.default.svc.cluster.local",\r\n  "message": "Deployment created successfully"\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response Codes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"})," - Deployment successful"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"})," - Invalid request"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"401 Unauthorized"})," - Invalid token"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"409 Conflict"})," - Service already exists"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"})," - Deployment failed"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"delete-peerv1servicesname",children:"DELETE /peer/v1/services/{name}"}),"\n",(0,i.jsx)(n.p,{children:"Delete a service deployment."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Path Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"})," - Service name to delete"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Query Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"namespace"}),' - Namespace (default: "default")']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "deleted",\r\n  "message": "Service payments deleted successfully"\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response Codes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"})," - Deleted successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"401 Unauthorized"})," - Invalid token"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"404 Not Found"})," - Service not found"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"})," - Deletion failed"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"get-peerv1metricsservice",children:"GET /peer/v1/metrics/{service}"}),"\n",(0,i.jsx)(n.p,{children:"Get RPS metrics for a service."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Path Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"service"})," - Service name"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Query Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"namespace"}),' - Namespace (default: "default")']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "payments",\r\n  "namespace": "default",\r\n  "isLocal": true,\r\n  "currentRps": 450.0,\r\n  "avgRps": 420.0,\r\n  "peakRps": 580.0,\r\n  "totalRequests": 1250000,\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response Codes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"})," - Metrics returned"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"401 Unauthorized"})," - Invalid token"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"404 Not Found"})," - Service not found"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"get-peerv1health",children:"GET /peer/v1/health"}),"\n",(0,i.jsx)(n.p,{children:"Health check endpoint."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "healthy",\r\n  "version": "v2.0.0",\r\n  "clusterId": "cluster-a"\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response Codes"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"})," - Healthy"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"503 Service Unavailable"})," - Unhealthy"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"internal-apis",children:"Internal APIs"}),"\n",(0,i.jsx)(n.h3,{id:"monitor-api",children:"Monitor API"}),"\n",(0,i.jsx)(n.p,{children:"Exposed by the Metrics Monitor service."}),"\n",(0,i.jsx)(n.h4,{id:"get-metricsstress",children:"GET /metrics/stress"}),"\n",(0,i.jsx)(n.p,{children:"Get stress metrics for a service."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Query Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"service"})," - Service name (required)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"namespace"}),' - Namespace (default: "default")']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "api",\r\n  "namespace": "default",\r\n  "podStress": [\r\n    {\r\n      "podName": "api-pod-1",\r\n      "cpuUsage": 0.85,\r\n      "memoryUsage": 0.70,\r\n      "stressLevel": "high"\r\n    }\r\n  ],\r\n  "avgStress": 0.85,\r\n  "maxStress": 0.92,\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"get-metricsrps",children:"GET /metrics/rps"}),"\n",(0,i.jsx)(n.p,{children:"Get RPS metrics for a service."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Query Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"service"})," - Service name (required)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"namespace"}),' - Namespace (default: "default")']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "api",\r\n  "namespace": "default",\r\n  "isLocal": true,\r\n  "currentRps": 450.0,\r\n  "avgRps": 420.0,\r\n  "peakRps": 580.0,\r\n  "totalRequests": 1250000,\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"get-metricscapacity",children:"GET /metrics/capacity"}),"\n",(0,i.jsx)(n.p,{children:"Get cluster capacity report."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "clusterId": "cluster-a",\r\n  "freeCpu": 4.5,\r\n  "freeMemory": 8.2,\r\n  "totalCpu": 8.0,\r\n  "totalMemory": 16.0,\r\n  "schedulablePods": 50,\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"get-metricssnapshot",children:"GET /metrics/snapshot"}),"\n",(0,i.jsx)(n.p,{children:"Get all metrics in one call."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "clusterId": "cluster-a",\r\n  "services": {\r\n    "api": {\r\n      "serviceName": "api",\r\n      "isLocal": true,\r\n      "currentRps": 450.0,\r\n      "avgStress": 0.85\r\n    },\r\n    "payments": {\r\n      "serviceName": "payments",\r\n      "isLocal": false,\r\n      "currentRps": 320.0,\r\n      "avgStress": 0.0\r\n    }\r\n  },\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"scheduler-api",children:"Scheduler API"}),"\n",(0,i.jsx)(n.p,{children:"Exposed by the Scheduler service."}),"\n",(0,i.jsx)(n.h4,{id:"post-placementdecide",children:"POST /placement/decide"}),"\n",(0,i.jsx)(n.p,{children:"Get placement decision."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "payments",\r\n  "namespace": "default",\r\n  "resources": {\r\n    "cpuRequest": "500m",\r\n    "memoryRequest": "512Mi"\r\n  },\r\n  "currentStress": 0.85,\r\n  "availableClusters": [\r\n    {\r\n      "clusterId": "cluster-b",\r\n      "apiEndpoint": "https://cluster-b.example.com",\r\n      "capacity": {\r\n        "freeCpu": 4.5,\r\n        "freeMemory": 8.0\r\n      },\r\n      "healthy": true\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "action": "deploy_remote",\r\n  "targetCluster": "cluster-b",\r\n  "reason": "local stress high, peer has capacity",\r\n  "recommendedReplicas": 2\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Action Values"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deploy_local"})," - Deploy on local cluster"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deploy_remote"})," - Deploy on peer cluster"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"no_action"})," - Do nothing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scale_local"})," - Scale existing local deployment"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-evictiondecide",children:"POST /eviction/decide"}),"\n",(0,i.jsx)(n.p,{children:"Get eviction decision based on LFU."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "currentServices": [\r\n    {\r\n      "serviceName": "api",\r\n      "isLocal": true,\r\n      "currentRps": 450.0\r\n    },\r\n    {\r\n      "serviceName": "old-api",\r\n      "isLocal": true,\r\n      "currentRps": 8.0\r\n    }\r\n  ],\r\n  "requiredSpace": {\r\n    "cpuRequest": "500m",\r\n    "memoryRequest": "512Mi"\r\n  },\r\n  "minRpsToKeep": 50.0\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "canMakeSpace": true,\r\n  "servicesToDelete": ["old-api"],\r\n  "reason": "service has low RPS and below threshold",\r\n  "lowestRps": 8.0\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-clustersscore",children:"POST /clusters/score"}),"\n",(0,i.jsx)(n.p,{children:"Score peer clusters for placement."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "clusters": [\r\n    {\r\n      "clusterId": "cluster-b",\r\n      "capacity": {\r\n        "freeCpu": 4.5,\r\n        "freeMemory": 8.0\r\n      },\r\n      "latency": 15000000\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "scores": {\r\n    "cluster-b": {\r\n      "totalScore": 0.85,\r\n      "cpuScore": 0.90,\r\n      "memoryScore": 0.80,\r\n      "latencyScore": 0.85\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"executor-api-local",children:"Executor API (Local)"}),"\n",(0,i.jsx)(n.p,{children:"Exposed by the Executor for local orchestrator."}),"\n",(0,i.jsx)(n.h4,{id:"post-apiv1deployments",children:"POST /api/v1/deployments"}),"\n",(0,i.jsx)(n.p,{children:"Create a deployment."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "payments",\r\n  "namespace": "default",\r\n  "image": "myapp:v1.0.0",\r\n  "replicas": 2,\r\n  "resources": {\r\n    "cpuRequest": "500m",\r\n    "memoryRequest": "512Mi",\r\n    "cpuLimit": "1000m",\r\n    "memoryLimit": "1Gi"\r\n  }\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "serviceName": "payments",\r\n  "endpoint": "payments.default.svc.cluster.local",\r\n  "message": "Deployment created successfully"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"delete-apiv1deploymentsname",children:"DELETE /api/v1/deployments/{name}"}),"\n",(0,i.jsx)(n.p,{children:"Delete a deployment."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Path Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"})," - Service name"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "deleted"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"patch-apiv1deploymentsnamescale",children:"PATCH /api/v1/deployments/{name}/scale"}),"\n",(0,i.jsx)(n.p,{children:"Scale a deployment."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Path Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"})," - Service name"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "replicas": 5\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "scaled",\r\n  "replicas": 5\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-apiv1traffic-splits",children:"POST /api/v1/traffic-splits"}),"\n",(0,i.jsx)(n.p,{children:"Create or update a TrafficSplit."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "api",\r\n  "namespace": "default",\r\n  "backends": [\r\n    {\r\n      "service": "api",\r\n      "weight": 70\r\n    },\r\n    {\r\n      "service": "api-mirrored",\r\n      "weight": 30\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "message": "Traffic split applied successfully"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"event-types",children:"Event Types"}),"\n",(0,i.jsx)(n.h3,{id:"stressevent",children:"StressEvent"}),"\n",(0,i.jsx)(n.p,{children:"Emitted when pod stress crosses threshold."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "api",\r\n  "namespace": "default",\r\n  "podName": "api-pod-1",\r\n  "cpuStress": 0.85,\r\n  "memoryStress": 0.70,\r\n  "stressLevel": "high",\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"highrpsevent",children:"HighRPSEvent"}),"\n",(0,i.jsx)(n.p,{children:"Emitted when service RPS exceeds threshold."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "payments-mirrored",\r\n  "namespace": "default",\r\n  "isLocal": false,\r\n  "currentRps": 500.0,\r\n  "threshold": 300.0,\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"lowrpsevent",children:"LowRPSEvent"}),"\n",(0,i.jsx)(n.p,{children:"Emitted when service RPS drops below threshold."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "old-api",\r\n  "namespace": "default",\r\n  "isLocal": true,\r\n  "currentRps": 8.0,\r\n  "threshold": 10.0,\r\n  "timestamp": "2024-01-15T10:30:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"error-responses",children:"Error Responses"}),"\n",(0,i.jsx)(n.p,{children:"All APIs use standard HTTP status codes and return errors in this format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "error": {\r\n    "code": "INSUFFICIENT_CAPACITY",\r\n    "message": "Not enough CPU to deploy service",\r\n    "details": {\r\n      "required": "2000m",\r\n      "available": "500m"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"common-error-codes",children:"Common Error Codes"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Code"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INVALID_REQUEST"})}),(0,i.jsx)(n.td,{children:"Request validation failed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UNAUTHORIZED"})}),(0,i.jsx)(n.td,{children:"Invalid or missing authentication"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NOT_FOUND"})}),(0,i.jsx)(n.td,{children:"Resource not found"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ALREADY_EXISTS"})}),(0,i.jsx)(n.td,{children:"Resource already exists"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INSUFFICIENT_CAPACITY"})}),(0,i.jsx)(n.td,{children:"Not enough cluster resources"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DEPLOYMENT_FAILED"})}),(0,i.jsx)(n.td,{children:"Kubernetes deployment failed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INTERNAL_ERROR"})}),(0,i.jsx)(n.td,{children:"Internal server error"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,i.jsx)(n.p,{children:"Peer API endpoints are rate limited:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Capacity checks"}),": 100 requests/hour per cluster"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Deployment operations"}),": 50 requests/hour per cluster"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metrics queries"}),": 200 requests/hour per cluster"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Rate limit headers:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-RateLimit-Limit: 100\r\nX-RateLimit-Remaining: 95\r\nX-RateLimit-Reset: 1642251600\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"versioning",children:"Versioning"}),"\n",(0,i.jsx)(n.p,{children:"API version is included in the URL path:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Current version: ",(0,i.jsx)(n.code,{children:"v1"})]}),"\n",(0,i.jsxs)(n.li,{children:["Peer API: ",(0,i.jsx)(n.code,{children:"/peer/v1/..."})]}),"\n",(0,i.jsxs)(n.li,{children:["Internal API: ",(0,i.jsx)(n.code,{children:"/api/v1/..."})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Breaking changes will increment the major version."})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>d});var s=r(6540);const i={},c=s.createContext(i);function l(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);