"use strict";(globalThis.webpackChunkdefogv_2_wiki=globalThis.webpackChunkdefogv_2_wiki||[]).push([[7311],{1470:(e,n,r)=>{r.d(n,{A:()=>k});var i=r(6540),s=r(4164),a=r(7559),t=r(3104),l=r(6347),c=r(205),o=r(7485),p=r(1682),d=r(679);function h(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:n,children:r}=e;return(0,i.useMemo)(()=>{const e=n??function(e){return h(e).map(({props:{value:e,label:n,attributes:r,default:i}})=>({value:e,label:n,attributes:r,default:i}))}(r);return function(e){const n=(0,p.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,r])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function v({queryString:e=!1,groupId:n}){const r=(0,l.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,o.aZ)(s),(0,i.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(r.location.search);n.set(s,e),r.replace({...r.location,search:n.toString()})},[s,r])]}function f(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,a=u(e),[t,l]=(0,i.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=n.find(e=>e.default)??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a})),[o,p]=v({queryString:r,groupId:s}),[h,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,s]=(0,d.Dv)(n);return[r,(0,i.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),g=(()=>{const e=o??h;return m({value:e,tabValues:a})?e:null})();(0,c.A)(()=>{g&&l(g)},[g]);return{selectedValue:t,selectValue:(0,i.useCallback)(e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),p(e),f(e)},[p,f,a]),tabValues:a}}var g=r(2303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(4848);function b({className:e,block:n,selectedValue:r,selectValue:i,tabValues:a}){const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,t.a_)(),o=e=>{const n=e.currentTarget,s=l.indexOf(n),t=a[s].value;t!==r&&(c(n),i(t))},p=e=>{let n=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;n=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;n=l[r]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:a.map(({value:e,label:n,attributes:i})=>(0,j.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{l.push(e)},onKeyDown:p,onClick:o,...i,className:(0,s.A)("tabs__item",x.tabItem,i?.className,{"tabs__item--active":r===e}),children:n??e},e))})}function y({lazy:e,children:n,selectedValue:r}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find(e=>e.props.value===r);return e?(0,i.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:a.map((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function w(e){const n=f(e);return(0,j.jsxs)("div",{className:(0,s.A)(a.G.tabs.container,"tabs-container",x.tabList),children:[(0,j.jsx)(b,{...n,...e}),(0,j.jsx)(y,{...n,...e})]})}function k(e){const n=(0,g.A)();return(0,j.jsx)(w,{...e,children:h(e.children)},String(n))}},2704:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"trafficsplit","title":"Traffic Splits & Management","description":"Understanding traffic management and routing in Linkerd","source":"@site/docs/trafficsplit.mdx","sourceDirName":".","slug":"/trafficsplit","permalink":"/defogv2-wiki/docs/trafficsplit","draft":false,"unlisted":false,"editUrl":"https://github.com/aprountzos/defogv2-wiki/tree/main/docs/docs/trafficsplit.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Traffic Splits & Management","description":"Understanding traffic management and routing in Linkerd","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Congratulations!","permalink":"/defogv2-wiki/docs/tutorial-basics/congratulations"},"next":{"title":"Tutorial - Extras","permalink":"/defogv2-wiki/docs/category/tutorial---extras"}}');var s=r(4848),a=r(8453),t=r(1470),l=r(9365);const c={title:"Traffic Splits & Management",description:"Understanding traffic management and routing in Linkerd",sidebar_position:3},o="Traffic Splits & Management",p={},d=[{value:"What is Traffic Management?",id:"what-is-traffic-management",level:2},{value:"Traffic Splits in Linkerd",id:"traffic-splits-in-linkerd",level:2},{value:"The Basic Concept",id:"the-basic-concept",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"TrafficSplit Resource Structure",id:"trafficsplit-resource-structure",level:2},{value:"Setting Up Traffic Splits",id:"setting-up-traffic-splits",level:2},{value:"Step 1: Deploy Multiple Service Versions",id:"step-1-deploy-multiple-service-versions",level:3},{value:"Step 2: Create the Apex Service",id:"step-2-create-the-apex-service",level:3},{value:"Step 3: Create the TrafficSplit",id:"step-3-create-the-trafficsplit",level:3},{value:"Step 4: Gradually Shift Traffic",id:"step-4-gradually-shift-traffic",level:3},{value:"Common Use Cases",id:"common-use-cases",level:2},{value:"1. Canary Deployments",id:"1-canary-deployments",level:3},{value:"2. Blue-Green Deployments",id:"2-blue-green-deployments",level:3},{value:"3. A/B Testing",id:"3-ab-testing",level:3},{value:"4. Multi-Cluster Failover",id:"4-multi-cluster-failover",level:3},{value:"Traffic Splits with Mirrored Services",id:"traffic-splits-with-mirrored-services",level:2},{value:"Scenario",id:"scenario",level:3},{value:"Using TrafficSplit with Mirrors",id:"using-trafficsplit-with-mirrors",level:3},{value:"Advanced Patterns",id:"advanced-patterns",level:2},{value:"Weighted Round-Robin Across Three Versions",id:"weighted-round-robin-across-three-versions",level:3},{value:"Cluster Locality Preference",id:"cluster-locality-preference",level:3},{value:"Namespace-Based Splits",id:"namespace-based-splits",level:3},{value:"Monitoring Traffic Splits",id:"monitoring-traffic-splits",level:2},{value:"Using Linkerd Viz",id:"using-linkerd-viz",level:3},{value:"Metrics to Watch",id:"metrics-to-watch",level:3},{value:"Dashboard View",id:"dashboard-view",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Start Conservative",id:"1-start-conservative",level:3},{value:"2. Monitor Before Increasing",id:"2-monitor-before-increasing",level:3},{value:"3. Use Meaningful Names",id:"3-use-meaningful-names",level:3},{value:"4. Document Your Splits",id:"4-document-your-splits",level:3},{value:"5. Have a Rollback Plan",id:"5-have-a-rollback-plan",level:3},{value:"6. Automate Gradual Rollouts",id:"6-automate-gradual-rollouts",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Traffic Not Splitting",id:"traffic-not-splitting",level:3},{value:"All Traffic Going to One Backend",id:"all-traffic-going-to-one-backend",level:3},{value:"Metrics Not Showing Split",id:"metrics-not-showing-split",level:3},{value:"Real-World Example: Complete Canary Deployment",id:"real-world-example-complete-canary-deployment",level:2},{value:"What&#39;s Next?",id:"whats-next",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"traffic-splits--management",children:"Traffic Splits & Management"})}),"\n",(0,s.jsx)(n.h2,{id:"what-is-traffic-management",children:"What is Traffic Management?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Traffic management"})," is the ability to control how requests flow between services in your system. Instead of requests always going to the same destination, you can:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Split traffic between multiple versions of a service"}),"\n",(0,s.jsx)(n.li,{children:"Route traffic based on conditions"}),"\n",(0,s.jsx)(n.li,{children:"Shift traffic gradually during deployments"}),"\n",(0,s.jsx)(n.li,{children:"Distribute load across clusters"}),"\n"]}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR\r\n    Client[Client]\r\n    Router[Traffic Manager]\r\n    V1[Service v1]\r\n    V2[Service v2]\r\n    \r\n    Client --\x3e|100 requests| Router\r\n    Router --\x3e|90 requests| V1\r\n    Router --\x3e|10 requests| V2"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Why this matters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Safe deployments (canary, blue-green)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 A/B testing"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Load distribution"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Failover handling"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Multi-cluster routing"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"traffic-splits-in-linkerd",children:"Traffic Splits in Linkerd"}),"\n",(0,s.jsxs)(n.p,{children:["Linkerd uses the ",(0,s.jsx)(n.strong,{children:"Service Mesh Interface (SMI)"})," ",(0,s.jsx)(n.code,{children:"TrafficSplit"})," resource to manage traffic distribution. It's a Kubernetes custom resource that tells Linkerd how to split traffic."]}),"\n",(0,s.jsx)(n.h3,{id:"the-basic-concept",children:"The Basic Concept"}),"\n",(0,s.jsx)(n.p,{children:"Without traffic splitting, Kubernetes routes requests to all pods equally:"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TB\r\n    Service[Kubernetes Service<br/>my-app]\r\n    Pod1[Pod v1]\r\n    Pod2[Pod v1]\r\n    Pod3[Pod v1]\r\n    \r\n    Service --\x3e|33%| Pod1\r\n    Service --\x3e|33%| Pod2\r\n    Service --\x3e|33%| Pod3"}),"\n",(0,s.jsx)(n.p,{children:"With traffic splitting, you control the distribution:"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TB\r\n    Client[Client Request]\r\n    Split[TrafficSplit<br/>my-app]\r\n    V1[my-app-v1<br/>90%]\r\n    V2[my-app-v2<br/>10%]\r\n    \r\n    Client --\x3e Split\r\n    Split --\x3e|90% of traffic| V1\r\n    Split --\x3e|10% of traffic| V2"}),"\n",(0,s.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant Client\r\n    participant Service as my-app Service\r\n    participant Split as TrafficSplit\r\n    participant V1 as my-app-v1\r\n    participant V2 as my-app-v2\r\n    \r\n    Client->>Service: Request\r\n    Service->>Split: Check routing rules\r\n    \r\n    alt 90% of requests\r\n        Split->>V1: Route to v1\r\n        V1->>Client: Response\r\n    else 10% of requests\r\n        Split->>V2: Route to v2\r\n        V2->>Client: Response\r\n    end"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"The flow:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Client calls the original service name (",(0,s.jsx)(n.code,{children:"my-app"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Linkerd intercepts the request"}),"\n",(0,s.jsx)(n.li,{children:"TrafficSplit resource defines the routing"}),"\n",(0,s.jsx)(n.li,{children:"Request goes to appropriate backend based on weights"}),"\n",(0,s.jsx)(n.li,{children:"Client receives response (doesn't know which version served it)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"trafficsplit-resource-structure",children:"TrafficSplit Resource Structure"}),"\n",(0,s.jsx)(n.p,{children:"Here's what a TrafficSplit looks like:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: my-app-split\r\n  namespace: default\r\nspec:\r\n  # The service clients call\r\n  service: my-app\r\n  \r\n  # Where traffic actually goes\r\n  backends:\r\n  - service: my-app-v1\r\n    weight: 900    # 90% of traffic\r\n  - service: my-app-v2\r\n    weight: 100    # 10% of traffic\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key fields:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Purpose"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"service"})}),(0,s.jsx)(n.td,{children:'The "virtual" service clients call'}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"my-app"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"backends"})}),(0,s.jsx)(n.td,{children:"List of actual services receiving traffic"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"my-app-v1"}),", ",(0,s.jsx)(n.code,{children:"my-app-v2"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"weight"})}),(0,s.jsx)(n.td,{children:"Proportion of traffic (out of 1000)"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"900"})," = 90%, ",(0,s.jsx)(n.code,{children:"100"})," = 10%"]})]})]})]}),"\n",(0,s.jsxs)(n.admonition,{title:"Weight System",type:"tip",children:[(0,s.jsx)(n.p,{children:"Weights are out of 1000, not 100. This allows fine-grained control:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"995"})," = 99.5%"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"5"})," = 0.5%"]}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-traffic-splits",children:"Setting Up Traffic Splits"}),"\n",(0,s.jsx)(n.h3,{id:"step-1-deploy-multiple-service-versions",children:"Step 1: Deploy Multiple Service Versions"}),"\n",(0,s.jsx)(n.p,{children:"Create your deployments and services:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Version 1\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: my-app-v1\r\nspec:\r\n  selector:\r\n    app: my-app\r\n    version: v1\r\n  ports:\r\n  - port: 8080\r\n---\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: my-app-v1\r\nspec:\r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      app: my-app\r\n      version: v1\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: my-app\r\n        version: v1\r\n    spec:\r\n      containers:\r\n      - name: app\r\n        image: my-app:v1\r\n        ports:\r\n        - containerPort: 8080\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Version 2  \r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: my-app-v2\r\nspec:\r\n  selector:\r\n    app: my-app\r\n    version: v2\r\n  ports:\r\n  - port: 8080\r\n---\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: my-app-v2\r\nspec:\r\n  replicas: 3\r\n  selector:\r\n    matchLabels:\r\n      app: my-app\r\n      version: v2\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: my-app\r\n        version: v2\r\n    spec:\r\n      containers:\r\n      - name: app\r\n        image: my-app:v2\r\n        ports:\r\n        - containerPort: 8080\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-create-the-apex-service",children:"Step 2: Create the Apex Service"}),"\n",(0,s.jsx)(n.p,{children:'The "apex" service is what clients call:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: my-app\r\nspec:\r\n  # No selector! TrafficSplit handles routing\r\n  ports:\r\n  - port: 8080\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,s.jsxs)(n.p,{children:["The apex service should have ",(0,s.jsx)(n.strong,{children:"no selector"}),". Linkerd uses TrafficSplit to route instead."]})}),"\n",(0,s.jsx)(n.h3,{id:"step-3-create-the-trafficsplit",children:"Step 3: Create the TrafficSplit"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: my-app-split\r\nspec:\r\n  service: my-app\r\n  backends:\r\n  - service: my-app-v1\r\n    weight: 1000   # Start with 100% on v1\r\n  - service: my-app-v2\r\n    weight: 0      # 0% on v2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-4-gradually-shift-traffic",children:"Step 4: Gradually Shift Traffic"}),"\n",(0,s.jsx)(n.p,{children:"Update the weights to shift traffic:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# 90% v1, 10% v2\r\nkubectl patch trafficsplit my-app-split --type merge -p '\r\nspec:\r\n  backends:\r\n  - service: my-app-v1\r\n    weight: 900\r\n  - service: my-app-v2\r\n    weight: 100\r\n'\r\n\r\n# 50% v1, 50% v2\r\nkubectl patch trafficsplit my-app-split --type merge -p '\r\nspec:\r\n  backends:\r\n  - service: my-app-v1\r\n    weight: 500\r\n  - service: my-app-v2\r\n    weight: 500\r\n'\r\n\r\n# 0% v1, 100% v2 (complete migration)\r\nkubectl patch trafficsplit my-app-split --type merge -p '\r\nspec:\r\n  backends:\r\n  - service: my-app-v1\r\n    weight: 0\r\n  - service: my-app-v2\r\n    weight: 1000\r\n'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,s.jsx)(n.h3,{id:"1-canary-deployments",children:"1. Canary Deployments"}),"\n",(0,s.jsx)(n.p,{children:"Gradually roll out a new version to minimize risk."}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TB\r\n    Start[Deploy v2 - 0% traffic] --\x3e Test1[Shift 10% to v2]\r\n    Test1 --\x3e Monitor1[Monitor metrics]\r\n    Monitor1 --\x3e Decision1{Looks good?}\r\n    Decision1 --\x3e|Yes| Test2[Shift 50% to v2]\r\n    Decision1 --\x3e|No| Rollback1[Rollback to 0%]\r\n    Test2 --\x3e Monitor2[Monitor metrics]\r\n    Monitor2 --\x3e Decision2{Looks good?}\r\n    Decision2 --\x3e|Yes| Complete[Shift 100% to v2]\r\n    Decision2 --\x3e|No| Rollback2[Rollback to 10%]"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TrafficSplit progression:"})}),"\n",(0,s.jsxs)(t.A,{children:[(0,s.jsx)(l.A,{value:"step1",label:"Step 1: Deploy",default:!0,children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Deploy v2, send no traffic yet\r\nbackends:\r\n- service: my-app-v1\r\n  weight: 1000\r\n- service: my-app-v2\r\n  weight: 0\n"})})}),(0,s.jsxs)(l.A,{value:"step2",label:"Step 2: Test (10%)",children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Send 10% of traffic to v2\r\nbackends:\r\n- service: my-app-v1\r\n  weight: 900\r\n- service: my-app-v2\r\n  weight: 100\n"})}),(0,s.jsx)(n.p,{children:"Monitor error rates, latency, resource usage"})]}),(0,s.jsx)(l.A,{value:"step3",label:"Step 3: Expand (50%)",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# If v2 looks good, increase to 50%\r\nbackends:\r\n- service: my-app-v1\r\n  weight: 500\r\n- service: my-app-v2\r\n  weight: 500\n"})})}),(0,s.jsxs)(l.A,{value:"step4",label:"Step 4: Complete (100%)",children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Full migration to v2\r\nbackends:\r\n- service: my-app-v1\r\n  weight: 0\r\n- service: my-app-v2\r\n  weight: 1000\n"})}),(0,s.jsx)(n.p,{children:"Now safe to delete v1"})]})]}),"\n",(0,s.jsx)(n.h3,{id:"2-blue-green-deployments",children:"2. Blue-Green Deployments"}),"\n",(0,s.jsx)(n.p,{children:"Keep two complete environments and switch instantly."}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR\r\n    subgraph Blue[Blue Environment]\r\n        BlueApp[App v1<br/>Currently Serving Traffic]\r\n    end\r\n    \r\n    subgraph Green[Green Environment]\r\n        GreenApp[App v2<br/>Ready, Not Serving]\r\n    end\r\n    \r\n    Router[TrafficSplit] --\x3e|100%| BlueApp\r\n    Router -.->|0%| GreenApp"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Switch instantly:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Before: All traffic to blue\r\nbackends:\r\n- service: my-app-blue\r\n  weight: 1000\r\n- service: my-app-green\r\n  weight: 0\r\n\r\n# After: Instant switch to green  \r\nbackends:\r\n- service: my-app-blue\r\n  weight: 0\r\n- service: my-app-green\r\n  weight: 1000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Instant rollback if issues found"}),"\n",(0,s.jsx)(n.li,{children:"Zero downtime"}),"\n",(0,s.jsx)(n.li,{children:"Full environment testing before switch"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-ab-testing",children:"3. A/B Testing"}),"\n",(0,s.jsx)(n.p,{children:"Send different traffic to different versions for testing."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# 50/50 split for A/B testing\r\napiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: frontend-ab-test\r\nspec:\r\n  service: frontend\r\n  backends:\r\n  - service: frontend-version-a\r\n    weight: 500\r\n  - service: frontend-version-b\r\n    weight: 500\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use case:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Test UI changes"}),"\n",(0,s.jsx)(n.li,{children:"Compare performance"}),"\n",(0,s.jsx)(n.li,{children:"Validate features"}),"\n",(0,s.jsx)(n.li,{children:"Gather metrics"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-multi-cluster-failover",children:"4. Multi-Cluster Failover"}),"\n",(0,s.jsx)(n.p,{children:"Route traffic between local and remote clusters."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: api-failover\r\nspec:\r\n  service: api\r\n  backends:\r\n  - service: api-local\r\n    weight: 1000        # Prefer local\r\n  - service: api-backup-cluster\r\n    weight: 0           # Backup only\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"When to switch:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Local cluster degraded"}),"\n",(0,s.jsx)(n.li,{children:"High latency detected"}),"\n",(0,s.jsx)(n.li,{children:"Resource constraints"}),"\n",(0,s.jsx)(n.li,{children:"Planned maintenance"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Switch to backup:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl patch trafficsplit api-failover --type merge -p '\r\nspec:\r\n  backends:\r\n  - service: api-local\r\n    weight: 0\r\n  - service: api-backup-cluster\r\n    weight: 1000\r\n'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"traffic-splits-with-mirrored-services",children:"Traffic Splits with Mirrored Services"}),"\n",(0,s.jsx)(n.p,{children:"In multi-cluster setups, TrafficSplits work with mirrored services."}),"\n",(0,s.jsx)(n.h3,{id:"scenario",children:"Scenario"}),"\n",(0,s.jsx)(n.p,{children:"You have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cluster A (Edge)"}),": Wants to call ",(0,s.jsx)(n.code,{children:"hello"})," service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cluster B (Fog)"}),": Has ",(0,s.jsx)(n.code,{children:"hello"})," service exported"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Linkerd creates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"In Cluster A"}),": ",(0,s.jsx)(n.code,{children:"hello-clusterB"})," (mirrored service)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"using-trafficsplit-with-mirrors",children:"Using TrafficSplit with Mirrors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: hello-split\r\n  namespace: default\r\nspec:\r\n  service: hello\r\n  backends:\r\n  - service: hello-local      # Local instance if exists\r\n    weight: 800               # Prefer local\r\n  - service: hello-clusterB   # Mirrored from Cluster B\r\n    weight: 200               # Use remote for 20%\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Traffic flow:"})}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TB\r\n    App[Application<br/>Cluster A]\r\n    Split[TrafficSplit<br/>hello]\r\n    Local[hello-local<br/>Cluster A]\r\n    Mirror[hello-clusterB<br/>Mirror]\r\n    Gateway[Gateway A]\r\n    Remote[hello<br/>Cluster B]\r\n    \r\n    App --\x3e|Call hello| Split\r\n    Split --\x3e|80%| Local\r\n    Split --\x3e|20%| Mirror\r\n    Mirror --\x3e Gateway\r\n    Gateway -.->|mTLS Tunnel| Remote"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use cases:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Load distribution across clusters"}),"\n",(0,s.jsx)(n.li,{children:"Gradual migration between clusters"}),"\n",(0,s.jsx)(n.li,{children:"Failover to remote cluster"}),"\n",(0,s.jsx)(n.li,{children:"Geographic routing"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"advanced-patterns",children:"Advanced Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"weighted-round-robin-across-three-versions",children:"Weighted Round-Robin Across Three Versions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: multi-version-split\r\nspec:\r\n  service: api\r\n  backends:\r\n  - service: api-v1\r\n    weight: 700    # 70% - stable version\r\n  - service: api-v2\r\n    weight: 250    # 25% - testing version\r\n  - service: api-v3\r\n    weight: 50     # 5% - experimental version\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cluster-locality-preference",children:"Cluster Locality Preference"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Prefer local cluster, fallback to remote\r\napiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: locality-split\r\nspec:\r\n  service: database\r\n  backends:\r\n  - service: database-local\r\n    weight: 900        # 90% local\r\n  - service: database-cloud\r\n    weight: 100        # 10% remote (for testing)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"namespace-based-splits",children:"Namespace-Based Splits"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Route based on where request originates\r\napiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: env-split\r\n  namespace: production\r\nspec:\r\n  service: shared-api\r\n  backends:\r\n  - service: api-prod\r\n    weight: 1000\r\n---\r\napiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: env-split\r\n  namespace: staging\r\nspec:\r\n  service: shared-api\r\n  backends:\r\n  - service: api-staging\r\n    weight: 1000\n"})}),"\n",(0,s.jsx)(n.h2,{id:"monitoring-traffic-splits",children:"Monitoring Traffic Splits"}),"\n",(0,s.jsx)(n.h3,{id:"using-linkerd-viz",children:"Using Linkerd Viz"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# View traffic distribution\r\nlinkerd viz stat trafficsplit\r\n\r\n# Watch specific split\r\nlinkerd viz stat trafficsplit/my-app-split\r\n\r\n# View live traffic\r\nlinkerd viz tap deploy/my-app-v1\r\nlinkerd viz tap deploy/my-app-v2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"metrics-to-watch",children:"Metrics to Watch"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Success Rate:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"linkerd viz stat deploy/my-app-v1 deploy/my-app-v2\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Latency:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"linkerd viz stat deploy/my-app-v1 deploy/my-app-v2 -o json | \\\r\n  jq '.rows[] | {name: .resource, p50: .stats.latency_ms_p50}'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request Volume:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"linkerd viz edges deployment\n"})}),"\n",(0,s.jsx)(n.h3,{id:"dashboard-view",children:"Dashboard View"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"linkerd viz dashboard\n"})}),"\n",(0,s.jsx)(n.p,{children:"In the dashboard:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Navigate to Deployments"}),"\n",(0,s.jsx)(n.li,{children:"Compare metrics between versions"}),"\n",(0,s.jsx)(n.li,{children:"Watch real-time traffic distribution"}),"\n",(0,s.jsx)(n.li,{children:"Monitor success rates and latency"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-start-conservative",children:"1. Start Conservative"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Start with small percentage\r\nbackends:\r\n- service: stable\r\n  weight: 990   # 99%\r\n- service: new\r\n  weight: 10    # 1%\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-monitor-before-increasing",children:"2. Monitor Before Increasing"}),"\n",(0,s.jsx)(n.p,{children:"Wait and watch metrics before increasing traffic:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Success rate stays high"}),"\n",(0,s.jsx)(n.li,{children:"Latency doesn't increase"}),"\n",(0,s.jsx)(n.li,{children:"No new errors"}),"\n",(0,s.jsx)(n.li,{children:"Resource usage acceptable"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-use-meaningful-names",children:"3. Use Meaningful Names"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Good\r\nservice: user-api\r\nbackends:\r\n- service: user-api-stable\r\n- service: user-api-canary\r\n\r\n# Bad\r\nservice: api\r\nbackends:\r\n- service: api1\r\n- service: api2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-document-your-splits",children:"4. Document Your Splits"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: payment-canary\r\n  annotations:\r\n    purpose: "Canary deployment for payment service v2.1"\r\n    owner: "payments-team"\r\n    created: "2024-01-15"\r\nspec:\r\n  service: payment\r\n  backends:\r\n  - service: payment-v2-0\r\n    weight: 950\r\n  - service: payment-v2-1\r\n    weight: 50\n'})}),"\n",(0,s.jsx)(n.h3,{id:"5-have-a-rollback-plan",children:"5. Have a Rollback Plan"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Save current state\r\nkubectl get trafficsplit my-app-split -o yaml > backup.yaml\r\n\r\n# Test new weights\r\nkubectl apply -f new-split.yaml\r\n\r\n# Rollback if needed\r\nkubectl apply -f backup.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"6-automate-gradual-rollouts",children:"6. Automate Gradual Rollouts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\r\n# gradual-rollout.sh\r\n\r\nSPLIT_NAME="my-app-split"\r\nSTEPS=(0 100 250 500 750 900 1000)\r\n\r\nfor weight in "${STEPS[@]}"; do\r\n  echo "Shifting to $weight/1000..."\r\n  \r\n  kubectl patch trafficsplit $SPLIT_NAME --type merge -p "\r\n  spec:\r\n    backends:\r\n    - service: my-app-v1\r\n      weight: $((1000 - weight))\r\n    - service: my-app-v2\r\n      weight: $weight\r\n  "\r\n  \r\n  echo "Waiting 5 minutes for metrics..."\r\n  sleep 300\r\n  \r\n  # Check metrics here\r\n  # If bad, rollback and exit\r\ndone\r\n\r\necho "Rollout complete!"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"traffic-not-splitting",children:"Traffic Not Splitting"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Check TrafficSplit exists:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get trafficsplit\r\nkubectl describe trafficsplit my-app-split\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Verify services exist:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get services my-app my-app-v1 my-app-v2\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Check apex service has no selector:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'kubectl get service my-app -o yaml | grep selector\r\n# Should return nothing or "selector: {}"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"all-traffic-going-to-one-backend",children:"All Traffic Going to One Backend"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Check weights:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get trafficsplit my-app-split -o yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Verify pods are running:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -l app=my-app,version=v2\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Check Linkerd proxy:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"linkerd viz stat deploy/my-app-v2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"metrics-not-showing-split",children:"Metrics Not Showing Split"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Ensure Linkerd injection:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -l app=my-app -o jsonpath='{.items[*].spec.containers[*].name}'\r\n# Should include \"linkerd-proxy\"\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Check SMI extension:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get crds | grep split\r\n# Should show: trafficsplits.split.smi-spec.io\n"})}),"\n",(0,s.jsx)(n.h2,{id:"real-world-example-complete-canary-deployment",children:"Real-World Example: Complete Canary Deployment"}),"\n",(0,s.jsx)(n.p,{children:"Here's a complete example deploying a canary update:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# 1. Original deployment (v1)\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: webapp-v1\r\nspec:\r\n  replicas: 5\r\n  selector:\r\n    matchLabels:\r\n      app: webapp\r\n      version: v1\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: webapp\r\n        version: v1\r\n      annotations:\r\n        linkerd.io/inject: enabled\r\n    spec:\r\n      containers:\r\n      - name: webapp\r\n        image: webapp:1.0.0\r\n        ports:\r\n        - containerPort: 8080\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: webapp-v1\r\nspec:\r\n  selector:\r\n    app: webapp\r\n    version: v1\r\n  ports:\r\n  - port: 80\r\n    targetPort: 8080\r\n---\r\n# 2. New canary deployment (v2)\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: webapp-v2\r\nspec:\r\n  replicas: 2\r\n  selector:\r\n    matchLabels:\r\n      app: webapp\r\n      version: v2\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: webapp\r\n        version: v2\r\n      annotations:\r\n        linkerd.io/inject: enabled\r\n    spec:\r\n      containers:\r\n      - name: webapp\r\n        image: webapp:2.0.0\r\n        ports:\r\n        - containerPort: 8080\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: webapp-v2\r\nspec:\r\n  selector:\r\n    app: webapp\r\n    version: v2\r\n  ports:\r\n  - port: 80\r\n    targetPort: 8080\r\n---\r\n# 3. Apex service (no selector)\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: webapp\r\nspec:\r\n  ports:\r\n  - port: 80\r\n    targetPort: 8080\r\n---\r\n# 4. TrafficSplit (start with 5% canary)\r\napiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: webapp-canary\r\nspec:\r\n  service: webapp\r\n  backends:\r\n  - service: webapp-v1\r\n    weight: 950\r\n  - service: webapp-v2\r\n    weight: 50\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Deployment process:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# 1. Deploy everything\r\nkubectl apply -f webapp-canary.yaml\r\n\r\n# 2. Monitor for 10 minutes\r\nlinkerd viz stat deploy/webapp-v1 deploy/webapp-v2\r\n\r\n# 3. If good, increase to 25%\r\nkubectl patch trafficsplit webapp-canary --type merge -p '\r\nspec:\r\n  backends:\r\n  - service: webapp-v1\r\n    weight: 750\r\n  - service: webapp-v2\r\n    weight: 250\r\n'\r\n\r\n# 4. Monitor again, then 50%\r\nkubectl patch trafficsplit webapp-canary --type merge -p '\r\nspec:\r\n  backends:\r\n  - service: webapp-v1\r\n    weight: 500\r\n  - service: webapp-v2\r\n    weight: 500\r\n'\r\n\r\n# 5. Finally, 100%\r\nkubectl patch trafficsplit webapp-canary --type merge -p '\r\nspec:\r\n  backends:\r\n  - service: webapp-v1\r\n    weight: 0\r\n  - service: webapp-v2\r\n    weight: 1000\r\n'\r\n\r\n# 6. Clean up old version\r\nkubectl delete deployment webapp-v1\r\nkubectl delete service webapp-v1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,s.jsx)(n.p,{children:"Now that you understand traffic management:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/local-setup/k3s-k3d",children:"K3s & K3d"})})," - Review cluster basics if needed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/local-setup/creating-clusters",children:"Creating Clusters"})})," - Build your multi-cluster environment"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/local-setup/installing-linkerd",children:"Installing Linkerd"})})," - Deploy Linkerd with SMI support"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/local-setup/testing-connectivity",children:"Testing Connectivity"})})," - Test traffic splits in action"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Resources:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/servicemeshinterface/smi-spec/blob/main/apis/traffic-split/v1alpha2/traffic-split.md",children:"SMI TrafficSplit Spec"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://linkerd.io/2.14/tasks/canary-release/",children:"Linkerd Traffic Split Guide"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://linkerd.io/2.14/tasks/books/",children:"Canary Deployments Best Practices"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var i=r(6540);const s={},a=i.createContext(s);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(a.Provider,{value:n},e.children)}},9365:(e,n,r)=>{r.d(n,{A:()=>t});r(6540);var i=r(4164);const s={tabItem:"tabItem_Ymn6"};var a=r(4848);function t({children:e,hidden:n,className:r}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.A)(s.tabItem,r),hidden:n,children:e})}}}]);