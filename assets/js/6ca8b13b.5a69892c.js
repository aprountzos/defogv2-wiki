"use strict";(globalThis.webpackChunkdefogv_2_wiki=globalThis.webpackChunkdefogv_2_wiki||[]).push([[2825],{916:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"architecture/components/executor","title":"Executor","description":"The Executor is the action layer of Defog v2. It executes all Kubernetes operations (deployments, traffic splits) and provides the API gateway for peer cluster communication.","source":"@site/docs/architecture/components/executor.mdx","sourceDirName":"architecture/components","slug":"/architecture/components/executor","permalink":"/defogv2-wiki/docs/architecture/components/executor","draft":false,"unlisted":false,"editUrl":"https://github.com/aprountzos/defogv2-wiki/tree/main/docs/docs/architecture/components/executor.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Orchestrator","permalink":"/defogv2-wiki/docs/architecture/components/orchestrator"},"next":{"title":"Linkerd Service Mesh","permalink":"/defogv2-wiki/docs/local-setup/linkerd"}}');var i=r(4848),l=r(8453);const t={},a="Executor",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Purpose",id:"purpose",level:2},{value:"1. Local Operations (for Orchestrator)",id:"1-local-operations-for-orchestrator",level:3},{value:"2. Peer API (for Remote Clusters)",id:"2-peer-api-for-remote-clusters",level:3},{value:"Architecture Components",id:"architecture-components",level:2},{value:"Core Components",id:"core-components",level:3},{value:"Dual API Design",id:"dual-api-design",level:2},{value:"Deployment Management",id:"deployment-management",level:2},{value:"Creating Deployments",id:"creating-deployments",level:3},{value:"Implementation Details",id:"implementation-details",level:3},{value:"TrafficSplit Management",id:"trafficsplit-management",level:2},{value:"Applying Traffic Splits",id:"applying-traffic-splits",level:3},{value:"Validation",id:"validation",level:2},{value:"Request Validator",id:"request-validator",level:3},{value:"Capacity Management",id:"capacity-management",level:2},{value:"Capacity Calculator",id:"capacity-calculator",level:3},{value:"Peer API",id:"peer-api",level:2},{value:"Handling Peer Requests",id:"handling-peer-requests",level:3},{value:"Can-Deploy Logic",id:"can-deploy-logic",level:3},{value:"Security",id:"security",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Configuration",id:"configuration",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"Local API",id:"local-api",level:3},{value:"POST /api/v1/deployments",id:"post-apiv1deployments",level:4},{value:"DELETE /api/v1/deployments/{name}",id:"delete-apiv1deploymentsname",level:4},{value:"PATCH /api/v1/deployments/{name}/scale",id:"patch-apiv1deploymentsnamescale",level:4},{value:"POST /api/v1/traffic-splits",id:"post-apiv1traffic-splits",level:4},{value:"Peer API",id:"peer-api-1",level:3},{value:"GET /peer/v1/capacity",id:"get-peerv1capacity",level:4},{value:"POST /peer/v1/can-deploy",id:"post-peerv1can-deploy",level:4},{value:"POST /peer/v1/deploy",id:"post-peerv1deploy",level:4},{value:"DELETE /peer/v1/services/{name}",id:"delete-peerv1servicesname",level:4},{value:"GET /peer/v1/health",id:"get-peerv1health",level:4},{value:"Deployment",id:"deployment",level:2},{value:"Kubernetes Manifests",id:"kubernetes-manifests",level:3},{value:"RBAC Requirements",id:"rbac-requirements",level:3},{value:"Monitoring &amp; Observability",id:"monitoring--observability",level:2},{value:"Logging",id:"logging",level:3},{value:"Metrics (Planned)",id:"metrics-planned",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"HTTP Error Codes",id:"http-error-codes",level:3},{value:"Validation Errors",id:"validation-errors",level:3},{value:"Kubernetes Errors",id:"kubernetes-errors",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Implementation Notes",id:"implementation-notes",level:2},{value:"What&#39;s Implemented",id:"whats-implemented",level:3},{value:"What&#39;s Simplified",id:"whats-simplified",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Source Code Structure",id:"source-code-structure",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"executor",children:"Executor"})}),"\n",(0,i.jsxs)(n.p,{children:["The Executor is the ",(0,i.jsx)(n.strong,{children:"action layer"})," of Defog v2. It executes all Kubernetes operations (deployments, traffic splits) and provides the API gateway for peer cluster communication."]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TB\r\n    subgraph Inputs\r\n        ORCH[Local Orchestrator]\r\n        PEER[Peer Clusters]\r\n    end\r\n    \r\n    subgraph Executor\r\n        VAL[Validator]\r\n        DM[Deployment Manager]\r\n        TM[TrafficSplit Manager]\r\n        API[Peer API]\r\n        AUDIT[Audit Logger]\r\n        CAP[Capacity Calculator]\r\n    end\r\n    \r\n    subgraph Outputs\r\n        K8S[Kubernetes API]\r\n        TS[TrafficSplit CRD]\r\n    end\r\n    \r\n    ORCH --\x3e VAL\r\n    PEER --\x3e API\r\n    VAL --\x3e DM\r\n    VAL --\x3e TM\r\n    API --\x3e VAL\r\n    API --\x3e CAP\r\n    \r\n    DM --\x3e K8S\r\n    TM --\x3e TS\r\n    \r\n    VAL --\x3e AUDIT\r\n    DM --\x3e AUDIT\r\n    TM --\x3e AUDIT\r\n    \r\n    style VAL fill:#fff4e1\r\n    style API fill:#e1f5ff\r\n    style AUDIT fill:#ffe1e1"}),"\n",(0,i.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,i.jsx)(n.p,{children:"The Executor serves dual roles:"}),"\n",(0,i.jsx)(n.h3,{id:"1-local-operations-for-orchestrator",children:"1. Local Operations (for Orchestrator)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create/delete Deployments"}),"\n",(0,i.jsx)(n.li,{children:"Scale workloads"}),"\n",(0,i.jsx)(n.li,{children:"Apply TrafficSplit CRDs"}),"\n",(0,i.jsx)(n.li,{children:"Validate operations"}),"\n",(0,i.jsx)(n.li,{children:"Provide audit logging"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-peer-api-for-remote-clusters",children:"2. Peer API (for Remote Clusters)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check capacity"}),"\n",(0,i.jsx)(n.li,{children:"Handle deployment requests"}),"\n",(0,i.jsx)(n.li,{children:"Return cluster metrics"}),"\n",(0,i.jsx)(n.li,{children:"Coordinate cross-cluster operations"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"architecture-components",children:"Architecture Components"}),"\n",(0,i.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server"})," - HTTP server handling both local and peer APIs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DeploymentManager"})," - Manages Kubernetes Deployment lifecycle"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TrafficSplitManager"})," - Applies SMI TrafficSplit CRDs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OperationValidator"})," - Validates all incoming requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CapacityCalculator"})," - Calculates cluster resource availability"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"AuditLogger"})," - Logs all operations for compliance"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"dual-api-design",children:"Dual API Design"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph LR\r\n    subgraph "Local API"\r\n        L1["POST /api/v1/deployments"]\r\n        L2["POST /api/v1/traffic-splits"]\r\n        L3["PATCH /api/v1/deployments/\\{name\\}/scale"]\r\n        L4["DELETE /api/v1/deployments/\\{name\\}"]\r\n    end\r\n    \r\n    subgraph "Peer API"\r\n        P1["GET /peer/v1/capacity"]\r\n        P2["POST /peer/v1/can-deploy"]\r\n        P3["POST /peer/v1/deploy"]\r\n        P4["DELETE /peer/v1/services/\\{name\\}"]\r\n        P5["GET /peer/v1/health"]\r\n    end\r\n    \r\n    ORCH[Local Orchestrator] --\x3e L1\r\n    ORCH --\x3e L2\r\n    ORCH --\x3e L3\r\n    ORCH --\x3e L4\r\n    \r\n    PEER[Peer Clusters] --\x3e P1\r\n    PEER --\x3e P2\r\n    PEER --\x3e P3\r\n    PEER --\x3e P4\r\n    PEER --\x3e P5\r\n    \r\n    L1 --\x3e K8S[Kubernetes API]\r\n    P3 --\x3e K8S\r\n    \r\n    style ORCH fill:#e1ffe1\r\n    style PEER fill:#e1f5ff'}),"\n",(0,i.jsx)(n.h2,{id:"deployment-management",children:"Deployment Management"}),"\n",(0,i.jsx)(n.h3,{id:"creating-deployments",children:"Creating Deployments"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant O as Orchestrator\r\n    participant E as Executor\r\n    participant V as Validator\r\n    participant K8S as Kubernetes API\r\n    participant A as Audit Log\r\n    \r\n    O->>E: POST /api/v1/deployments<br/>{service, image, replicas}\r\n    E->>V: Validate request\r\n    V->>V: Check resources\r\n    V->>V: Check foreign limits\r\n    V--\x3e>E: Valid\r\n    \r\n    E->>K8S: Create Deployment\r\n    K8S--\x3e>E: Deployment created\r\n    E->>K8S: Create Service\r\n    K8S--\x3e>E: Service created\r\n    E->>A: Log deployment\r\n    E--\x3e>O: {success: true, endpoint}"}),"\n",(0,i.jsx)(n.h3,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"DeploymentManager"})," handles the complete lifecycle:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type DeploymentManager struct {\r\n    client    kubernetes.Interface\r\n    validator *OperationValidator\r\n    auditLog  *AuditLogger\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Features:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Validates all requests before execution"}),"\n",(0,i.jsx)(n.li,{children:"Parses resource quantities (CPU/memory)"}),"\n",(0,i.jsxs)(n.li,{children:["Creates Deployment with proper labels (",(0,i.jsx)(n.code,{children:"app"}),", ",(0,i.jsx)(n.code,{children:"managed-by"}),", ",(0,i.jsx)(n.code,{children:"source-cluster"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Automatically creates corresponding Service"}),"\n",(0,i.jsx)(n.li,{children:"Logs all operations to audit log"}),"\n",(0,i.jsx)(n.li,{children:"Returns service endpoint for DNS resolution"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resource Management:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Supports CPU/memory requests and limits"}),"\n",(0,i.jsx)(n.li,{children:'Validates resource format (e.g., "500m", "512Mi")'}),"\n",(0,i.jsx)(n.li,{children:"Enforces foreign workload limits via validator"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Labels Applied:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"app: <service-name>\r\nmanaged-by: defog-v2\r\nsource-cluster: <cluster-id>  # For peer workloads\n"})}),"\n",(0,i.jsx)(n.h2,{id:"trafficsplit-management",children:"TrafficSplit Management"}),"\n",(0,i.jsx)(n.h3,{id:"applying-traffic-splits",children:"Applying Traffic Splits"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"TrafficSplitManager"})," uses Kubernetes dynamic client to manage SMI TrafficSplit CRDs:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type TrafficSplitManager struct {\r\n    dynamicClient dynamic.Interface\r\n    auditLog      *AuditLogger\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Process:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Validates backend weights sum to 100"}),"\n",(0,i.jsx)(n.li,{children:"Builds unstructured TrafficSplit object"}),"\n",(0,i.jsx)(n.li,{children:"Attempts update (if exists) or create (if new)"}),"\n",(0,i.jsx)(n.li,{children:"Logs operation to audit"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"TrafficSplit Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: split.smi-spec.io/v1alpha1\r\nkind: TrafficSplit\r\nmetadata:\r\n  name: <service-name>\r\n  namespace: <namespace>\r\nspec:\r\n  service: <service-name>\r\n  backends:\r\n    - service: api\r\n      weight: 70\r\n    - service: api-v2\r\n      weight: 30\n"})}),"\n",(0,i.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,i.jsx)(n.h3,{id:"request-validator",children:"Request Validator"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"OperationValidator"})," ensures all requests meet requirements:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type OperationValidator struct {\r\n    config *Config\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation Checks:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Service name required"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Namespace required"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Image required"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Replicas >= 1"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 CPU request required and valid format"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Foreign workload CPU limit enforcement"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Foreign Workload Protection:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Checks if ",(0,i.jsx)(n.code,{children:"SourceCluster != ClusterID"})]}),"\n",(0,i.jsxs)(n.li,{children:["Enforces ",(0,i.jsx)(n.code,{children:"MaxForeignCPU"})," limit"]}),"\n",(0,i.jsx)(n.li,{children:"Prevents peer clusters from overwhelming local cluster"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"capacity-management",children:"Capacity Management"}),"\n",(0,i.jsx)(n.h3,{id:"capacity-calculator",children:"Capacity Calculator"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"CapacityCalculator"})," queries Kubernetes nodes for resource availability:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type CapacityCalculator struct {\r\n    client kubernetes.Interface\r\n    config *Config\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Metrics Calculated:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Total CPU across all nodes (in cores)"}),"\n",(0,i.jsx)(n.li,{children:"Total Memory across all nodes (in GiB)"}),"\n",(0,i.jsx)(n.li,{children:"Free/Allocatable CPU"}),"\n",(0,i.jsx)(n.li,{children:"Free/Allocatable Memory"}),"\n",(0,i.jsx)(n.li,{children:"Schedulable pods (estimated)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Peer API uses this for capacity checks"}),"\n",(0,i.jsx)(n.li,{children:"Determines if deployment requests can be satisfied"}),"\n",(0,i.jsx)(n.li,{children:"Supports LFU eviction decisions (orchestrator integration)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"peer-api",children:"Peer API"}),"\n",(0,i.jsx)(n.h3,{id:"handling-peer-requests",children:"Handling Peer Requests"}),"\n",(0,i.jsx)(n.mermaid,{value:'sequenceDiagram\r\n    participant P as Peer Orchestrator\r\n    participant E as Executor\r\n    participant V as Validator\r\n    participant C as Capacity Calc\r\n    participant K8S as Kubernetes\r\n    \r\n    Note over P: Need to deploy service\r\n    P->>E: POST /peer/v1/can-deploy\r\n    E->>E: Check if already deployed\r\n    \r\n    alt Already Deployed\r\n        E--\x3e>P: {"status": "already_have_it"}\r\n    else Not Deployed\r\n        E->>C: Get capacity\r\n        C->>K8S: Query nodes\r\n        K8S--\x3e>C: Node metrics\r\n        C--\x3e>E: Capacity report\r\n        \r\n        alt Has Capacity\r\n            E--\x3e>P: {"status": "will_deploy"}\r\n            P->>E: POST /peer/v1/deploy\r\n            E->>V: Validate\r\n            E->>K8S: Create deployment\r\n            E--\x3e>P: {"success": true}\r\n        else No Capacity\r\n            E--\x3e>P: {"status": "cannot_deploy"}\r\n        end\r\n    end'}),"\n",(0,i.jsx)(n.h3,{id:"can-deploy-logic",children:"Can-Deploy Logic"}),"\n",(0,i.jsx)(n.p,{children:"The executor determines if it can accept a peer workload:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Already deployed?"})," \u2192 Return ",(0,i.jsx)(n.code,{children:"already_have_it"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check capacity"})," \u2192 Query nodes for free resources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sufficient resources?"})," \u2192 Return ",(0,i.jsx)(n.code,{children:"will_deploy"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Insufficient resources?"})," \u2192 Return ",(0,i.jsx)(n.code,{children:"cannot_deploy"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," LFU eviction logic is handled by the orchestrator, not the executor. The executor only reports capacity."]}),"\n",(0,i.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,i.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.p,{children:"All Peer API endpoints require Bearer token authentication:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"func (s *Server) authenticate(next http.HandlerFunc) http.HandlerFunc {\r\n    // Validates Authorization header\r\n    // Checks against configured AUTH_TOKEN\r\n    // Returns 401 if invalid\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Protected Endpoints:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/peer/v1/capacity"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/peer/v1/can-deploy"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/peer/v1/deploy"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/peer/v1/services/\\{name\\}"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Public Endpoints:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/peer/v1/health"})," (for monitoring)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Security settings via environment variables:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"AUTH_TOKEN=your-secure-token-here\r\nCLUSTER_ID=cluster-a\r\nMAX_FOREIGN_CPU=2000m\r\nPORT=8080\n"})}),"\n",(0,i.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,i.jsx)(n.h3,{id:"local-api",children:"Local API"}),"\n",(0,i.jsx)(n.h4,{id:"post-apiv1deployments",children:"POST /api/v1/deployments"}),"\n",(0,i.jsx)(n.p,{children:"Create a deployment."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "api",\r\n  "namespace": "default",\r\n  "image": "myapp:v1.0.0",\r\n  "replicas": 2,\r\n  "resources": {\r\n    "cpuRequest": "500m",\r\n    "memoryRequest": "512Mi",\r\n    "cpuLimit": "1000m",\r\n    "memoryLimit": "1Gi"\r\n  },\r\n  "sourceCluster": "cluster-b"\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "serviceName": "api",\r\n  "endpoint": "api.default.svc.cluster.local",\r\n  "message": "Deployment created successfully"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"delete-apiv1deploymentsname",children:"DELETE /api/v1/deployments/{name}"}),"\n",(0,i.jsx)(n.p,{children:"Delete a deployment and its service."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "deleted",\r\n  "message": "Service api deleted"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"patch-apiv1deploymentsnamescale",children:"PATCH /api/v1/deployments/{name}/scale"}),"\n",(0,i.jsx)(n.p,{children:"Scale a deployment."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "replicas": 5\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "scaled",\r\n  "replicas": 5\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-apiv1traffic-splits",children:"POST /api/v1/traffic-splits"}),"\n",(0,i.jsx)(n.p,{children:"Apply traffic split."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "api",\r\n  "namespace": "default",\r\n  "backends": [\r\n    {"service": "api", "weight": 70},\r\n    {"service": "api-v2", "weight": 30}\r\n  ]\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "message": "Traffic split applied successfully"\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Backend weights must sum to exactly 100"}),"\n",(0,i.jsx)(n.li,{children:"Returns error if sum != 100"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"peer-api-1",children:"Peer API"}),"\n",(0,i.jsxs)(n.p,{children:["All peer endpoints require ",(0,i.jsx)(n.code,{children:"Authorization: Bearer <token>"})," header."]}),"\n",(0,i.jsx)(n.h4,{id:"get-peerv1capacity",children:"GET /peer/v1/capacity"}),"\n",(0,i.jsx)(n.p,{children:"Get cluster capacity metrics."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "clusterId": "cluster-a",\r\n  "freeCpu": 4.5,\r\n  "freeMemory": 8.2,\r\n  "totalCpu": 8.0,\r\n  "totalMemory": 16.0,\r\n  "schedulablePods": 110\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-peerv1can-deploy",children:"POST /peer/v1/can-deploy"}),"\n",(0,i.jsx)(n.p,{children:"Check if can deploy service."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "serviceName": "payments",\r\n  "namespace": "default",\r\n  "resources": {\r\n    "cpuRequest": "500m",\r\n    "memoryRequest": "512Mi"\r\n  },\r\n  "sourceCluster": "cluster-b",\r\n  "currentRps": 450.0\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "will_deploy",\r\n  "message": "Deployment initiated",\r\n  "estimatedTime": "30s"\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Status Values:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"already_have_it"})," - Service already exists locally"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"will_deploy"})," - Will deploy the service"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cannot_deploy"})," - Insufficient capacity (see ",(0,i.jsx)(n.code,{children:"reason"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"post-peerv1deploy",children:"POST /peer/v1/deploy"}),"\n",(0,i.jsx)(n.p,{children:"Deploy a service from peer cluster."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Request:"})," Same as local deployment API"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response:"})," Same as local deployment API"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Subject to ",(0,i.jsx)(n.code,{children:"MaxForeignCPU"})," limit"]}),"\n",(0,i.jsx)(n.li,{children:"Validates all resources"}),"\n",(0,i.jsxs)(n.li,{children:["Labels with ",(0,i.jsx)(n.code,{children:"source-cluster"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"delete-peerv1servicesname",children:"DELETE /peer/v1/services/{name}"}),"\n",(0,i.jsx)(n.p,{children:"Delete a service deployed by peer."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "deleted"\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"get-peerv1health",children:"GET /peer/v1/health"}),"\n",(0,i.jsx)(n.p,{children:"Health check endpoint (no auth required)."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "healthy",\r\n  "clusterId": "cluster-a",\r\n  "version": "v2.0.0"\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes-manifests",children:"Kubernetes Manifests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: defog-config\r\n  namespace: defog-system\r\ndata:\r\n  CLUSTER_ID: "cluster-a"\r\n  MAX_FOREIGN_CPU: "2000m"\r\n  PORT: "8080"\r\n---\r\napiVersion: v1\r\nkind: Secret\r\nmetadata:\r\n  name: defog-secrets\r\n  namespace: defog-system\r\ntype: Opaque\r\nstringData:\r\n  AUTH_TOKEN: "your-secure-token-here"\r\n---\r\napiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: executor\r\n  namespace: defog-system\r\nspec:\r\n  replicas: 1\r\n  selector:\r\n    matchLabels:\r\n      app: executor\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: executor\r\n    spec:\r\n      serviceAccountName: defog-controller\r\n      containers:\r\n      - name: executor\r\n        image: registry.io/defog-executor:v2.0.0\r\n        ports:\r\n        - containerPort: 8080\r\n          name: http\r\n        env:\r\n        - name: AUTH_TOKEN\r\n          valueFrom:\r\n            secretKeyRef:\r\n              name: defog-secrets\r\n              key: AUTH_TOKEN\r\n        envFrom:\r\n        - configMapRef:\r\n            name: defog-config\r\n        resources:\r\n          requests:\r\n            cpu: 200m\r\n            memory: 256Mi\r\n          limits:\r\n            cpu: 500m\r\n            memory: 512Mi\r\n        livenessProbe:\r\n          httpGet:\r\n            path: /peer/v1/health\r\n            port: 8080\r\n          initialDelaySeconds: 10\r\n          periodSeconds: 30\r\n        readinessProbe:\r\n          httpGet:\r\n            path: /peer/v1/health\r\n            port: 8080\r\n          initialDelaySeconds: 5\r\n          periodSeconds: 10\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: executor\r\n  namespace: defog-system\r\nspec:\r\n  type: LoadBalancer  # For peer access\r\n  selector:\r\n    app: executor\r\n  ports:\r\n  - port: 443\r\n    targetPort: 8080\r\n    name: https\n'})}),"\n",(0,i.jsx)(n.h3,{id:"rbac-requirements",children:"RBAC Requirements"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\r\nkind: ServiceAccount\r\nmetadata:\r\n  name: defog-controller\r\n  namespace: defog-system\r\n---\r\napiVersion: rbac.authorization.k8s.io/v1\r\nkind: ClusterRole\r\nmetadata:\r\n  name: executor-role\r\nrules:\r\n# Deployment management\r\n- apiGroups: ["apps"]\r\n  resources: ["deployments"]\r\n  verbs: ["create", "delete", "patch", "get", "list", "update"]\r\n\r\n# Service management\r\n- apiGroups: [""]\r\n  resources: ["services"]\r\n  verbs: ["create", "delete", "get", "list"]\r\n\r\n# TrafficSplit CRD\r\n- apiGroups: ["split.smi-spec.io"]\r\n  resources: ["trafficsplits"]\r\n  verbs: ["create", "patch", "get", "list", "update"]\r\n\r\n# Capacity calculation\r\n- apiGroups: [""]\r\n  resources: ["nodes"]\r\n  verbs: ["get", "list"]\r\n\r\n- apiGroups: [""]\r\n  resources: ["pods"]\r\n  verbs: ["get", "list"]\r\n---\r\napiVersion: rbac.authorization.k8s.io/v1\r\nkind: ClusterRoleBinding\r\nmetadata:\r\n  name: executor-binding\r\nroleRef:\r\n  apiGroup: rbac.authorization.k8s.io\r\n  kind: ClusterRole\r\n  name: executor-role\r\nsubjects:\r\n- kind: ServiceAccount\r\n  name: defog-controller\r\n  namespace: defog-system\n'})}),"\n",(0,i.jsx)(n.h2,{id:"monitoring--observability",children:"Monitoring & Observability"}),"\n",(0,i.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,i.jsx)(n.p,{children:"All operations are logged with structured output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[AUDIT] 2024-12-08T10:30:45Z - Operation: deploy - Data: {serviceName:api namespace:default...}\r\n[AUDIT] 2024-12-08T10:31:12Z - Operation: scale - Data: {name:api replicas:5}\r\n[AUDIT] 2024-12-08T10:32:03Z - Operation: traffic-split - Data: {serviceName:api backends:[...]}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"metrics-planned",children:"Metrics (Planned)"}),"\n",(0,i.jsx)(n.p,{children:"The implementation is ready for Prometheus instrumentation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-promql",children:'# Deployments created\r\nrate(defog_executor_deployments_total[5m])\r\n\r\n# Deployment errors\r\nrate(defog_executor_deployment_errors_total[5m])\r\n\r\n# TrafficSplit updates\r\nrate(defog_executor_traffic_splits_total[5m])\r\n\r\n# Peer API requests by cluster\r\nrate(defog_executor_peer_requests_total{cluster="cluster-b"}[5m])\r\n\r\n# Operation duration\r\nhistogram_quantile(0.95, defog_executor_operation_duration_seconds)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.h3,{id:"http-error-codes",children:"HTTP Error Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"})," - Invalid JSON or missing required fields"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"401 Unauthorized"})," - Missing or invalid auth token (peer API only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"405 Method Not Allowed"})," - Wrong HTTP method"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"})," - Kubernetes API errors or internal failures"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,i.jsx)(n.p,{children:"All validation errors return descriptive messages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "error": "validation failed: CPU request exceeds max foreign CPU (2000m)"\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes-errors",children:"Kubernetes Errors"}),"\n",(0,i.jsx)(n.p,{children:"Kubernetes client errors are wrapped and returned:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "error": "failed to create deployment: deployments.apps \\"api\\" already exists"\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always validate requests"})," - Use the validator before any K8s operation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Log all operations"})," - Audit trail is critical for debugging"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check capacity first"})," - Verify resources before deploying"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use structured labels"})," - Enables proper service discovery and management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Secure peer communication"})," - Always use authentication tokens"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Monitor resource usage"})," - Track executor's own resource consumption"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle errors gracefully"})," - Return descriptive errors, don't panic"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"implementation-notes",children:"Implementation Notes"}),"\n",(0,i.jsx)(n.h3,{id:"whats-implemented",children:"What's Implemented"}),"\n",(0,i.jsx)(n.p,{children:"\u2705 Full deployment lifecycle (create, delete, scale)\r\n\u2705 Service creation alongside deployments\r\n\u2705 TrafficSplit CRD management\r\n\u2705 Request validation with foreign workload limits\r\n\u2705 Capacity calculation from node metrics\r\n\u2705 Peer API with authentication\r\n\u2705 Audit logging for all operations\r\n\u2705 Health check endpoint\r\n\u2705 Proper error handling and HTTP status codes"}),"\n",(0,i.jsx)(n.h3,{id:"whats-simplified",children:"What's Simplified"}),"\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"LFU Eviction Logic"})," - The can-deploy endpoint checks capacity but doesn't implement eviction. That's the orchestrator's responsibility."]}),"\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Rollback Capability"})," - Mentioned in docs but not fully implemented. Would require storing previous deployment state."]}),"\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Prometheus Metrics"})," - Framework ready but metrics not instrumented yet."]}),"\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"mTLS"})," - Currently uses bearer token auth. Production should use mTLS for peer communication."]}),"\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"Rate Limiting"})," - Not implemented. Should be added to prevent peer API abuse."]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," ",(0,i.jsx)(n.code,{children:"failed to create k8s config: unable to load in-cluster configuration"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Not running inside Kubernetes cluster"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Use kubeconfig for local development or deploy to cluster"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," ",(0,i.jsx)(n.code,{children:"failed to create deployment: forbidden"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," ServiceAccount lacks RBAC permissions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Apply the ClusterRole and ClusterRoleBinding manifests"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," ",(0,i.jsx)(n.code,{children:"Unauthorized"})," on peer API calls"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Missing or incorrect AUTH_TOKEN"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Ensure token matches on both clusters"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," ",(0,i.jsx)(n.code,{children:"validation failed: CPU request exceeds max foreign CPU"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Peer workload exceeds MAX_FOREIGN_CPU limit"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Increase limit or reduce peer request"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue:"})," Service endpoint not resolving"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Service creation failed silently"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Check logs for service creation errors"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"source-code-structure",children:"Source Code Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"internal/executor/\r\n\u251c\u2500\u2500 main.go              # Server setup and main()\r\n\u251c\u2500\u2500 types.go             # Request/response types\r\n\u251c\u2500\u2500 validator.go         # OperationValidator\r\n\u251c\u2500\u2500 deployment_mgr.go    # DeploymentManager\r\n\u251c\u2500\u2500 trafficsplit_mgr.go  # TrafficSplitManager\r\n\u251c\u2500\u2500 capacity_calc.go     # CapacityCalculator\r\n\u251c\u2500\u2500 audit_log.go         # AuditLogger\r\n\u251c\u2500\u2500 local_api.go         # Local API handlers\r\n\u2514\u2500\u2500 peer_api.go          # Peer API handlers\n"})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var s=r(6540);const i={},l=s.createContext(i);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);